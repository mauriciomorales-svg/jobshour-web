"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{8573:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),r=a(2265),n=a(1837),l=a(166);let i={wrench:"\uD83D\uDD27",zap:"⚡",paintbrush:"\uD83C\uDFA8",sparkles:"✨",hammer:"\uD83D\uDD28",leaf:"\uD83C\uDF3F",key:"\uD83D\uDD11",building:"\uD83C\uDFD7️",scissors:"✂️","paw-print":"\uD83D\uDC3E",truck:"\uD83D\uDE9A","shopping-cart":"\uD83D\uDED2",car:"\uD83D\uDE97",baby:"\uD83D\uDC76","heart-handshake":"\uD83E\uDD1D",dog:"\uD83D\uDC15","graduation-cap":"\uD83C\uDF93",music:"\uD83C\uDFB5",hand:"\uD83D\uDC86",activity:"\uD83C\uDFC3",utensils:"\uD83C\uDF7D️","chef-hat":"\uD83D\uDC68‍\uD83C\uDF73",disc:"\uD83C\uDFA7",camera:"\uD83D\uDCF7",monitor:"\uD83D\uDCBB",wifi:"\uD83D\uDCF6",flame:"\uD83D\uDD25",rabbit:"\uD83D\uDC07",droplet:"\uD83D\uDCA7",droplets:"\uD83D\uDCA7","key-round":"\uD83D\uDD11","hard-hat":"\uD83D\uDC77",trees:"\uD83C\uDF33",home:"\uD83C\uDFE0",package:"\uD83D\uDCE6"};function o(e){return e&&i[e]||"\uD83D\uDCCB"}function u(e){let{categories:t,selectedId:a,onSelect:n,placeholder:l="Buscar categor\xeda...",multiple:i=!1,selectedIds:u=[],onSelectMultiple:d}=e,[c,m]=(0,r.useState)(""),[x,p]=(0,r.useState)(!1),h=(0,r.useRef)(null),g=(0,r.useRef)(null),b=t.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),D=t.find(e=>e.id===a);function f(e){i&&d?d(u.includes(e)?u.filter(t=>t!==e):[...u,e]):(n(e),p(!1),m(""))}return(0,r.useEffect)(()=>{function e(e){h.current&&!h.current.contains(e.target)&&p(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.jsxs)("div",{ref:h,className:"relative",children:[(0,s.jsxs)("div",{onClick:()=>{p(!x),setTimeout(()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.focus()},50)},className:"w-full px-3 py-2 border rounded-lg cursor-pointer flex items-center justify-between bg-white hover:border-gray-400 transition",children:[i?(0,s.jsx)("span",{className:"text-sm truncate",children:u.length>0?"".concat(u.length," categor\xeda").concat(u.length>1?"s":""," seleccionada").concat(u.length>1?"s":""):(0,s.jsx)("span",{className:"text-gray-400",children:l})}):(0,s.jsx)("span",{className:"text-sm truncate",children:D?(0,s.jsxs)("span",{children:[o(D.icon)," ",D.name]}):(0,s.jsx)("span",{className:"text-gray-400",children:l})}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition ".concat(x?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&u.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:u.map(e=>{let a=t.find(t=>t.id===e);return a?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs font-semibold px-2 py-1 rounded-full",style:{backgroundColor:(a.color||"#6b7280")+"20",color:a.color||"#6b7280"},children:[o(a.icon)," ",a.name,(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),f(e)},className:"ml-0.5 hover:opacity-70",children:"\xd7"})]},e):null})}),x&&(0,s.jsxs)("div",{className:"absolute z-50 mt-1 w-full bg-white border rounded-lg shadow-xl max-h-64 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-2 border-b sticky top-0 bg-white",children:(0,s.jsx)("input",{ref:g,type:"text",value:c,onChange:e=>m(e.target.value),placeholder:"\uD83D\uDD0D Buscar...",className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-300",autoFocus:!0})}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-48",children:0===b.length?(0,s.jsx)("div",{className:"p-3 text-center text-gray-400 text-sm",children:"No se encontraron categor\xedas"}):b.map(e=>{let t=i?u.includes(e.id):e.id===a;return(0,s.jsxs)("button",{onClick:()=>f(e.id),className:"w-full flex items-center gap-2.5 px-3 py-2.5 text-left text-sm hover:bg-gray-50 transition ".concat(t?"bg-blue-50 font-bold":""),children:[(0,s.jsx)("span",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-base shrink-0",style:{backgroundColor:(e.color||"#6b7280")+"20"},children:o(e.icon)}),(0,s.jsx)("span",{className:"truncate",children:e.name}),t&&(0,s.jsx)("span",{className:"ml-auto text-blue-500 font-bold",children:"✓"})]},e.id)})})]})]})}let d=(0,l.default)(()=>a.e(740).then(a.bind(a,6740)),{loadableGenerated:{webpack:()=>[6740]},ssr:!1});function c(e){let{userLat:t,userLng:a,categories:l,onClose:i,onPublished:o}=e,[c,m]=(0,r.useState)("fixed_job"),[x,p]=(0,r.useState)("passenger"),[h,g]=(0,r.useState)(null),[b,D]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[y,v]=(0,r.useState)("medium"),[N,w]=(0,r.useState)(30),[C,S]=(0,r.useState)(""),[_,k]=(0,r.useState)(""),[E,F]=(0,r.useState)(t),[O,I]=(0,r.useState)(a),[L,B]=(0,r.useState)(null),[A,P]=(0,r.useState)(null),[T,z]=(0,r.useState)(""),[R,q]=(0,r.useState)(1),[J,Q]=(0,r.useState)(""),[U,M]=(0,r.useState)(""),[G,V]=(0,r.useState)(""),[W,$]=(0,r.useState)("medium"),[H,K]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(""),[Z,ee]=(0,r.useState)(1),[et,ea]=(0,r.useState)("once"),[es,er]=(0,r.useState)([]),[en,el]=(0,r.useState)(null),[ei,eo]=(0,r.useState)(null),[eu,ed]=(0,r.useState)(!1),[ec,em]=(0,r.useState)("");(0,r.useEffect)(()=>{"fixed_job"===c&&g(null)},[c]),(0,r.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{F(e.coords.latitude),I(e.coords.longitude)},()=>{})},[]);let ex=async()=>{if(em(""),!h){em("Selecciona una categor\xeda");return}if(!b.trim()){em("Ingresa una descripci\xf3n");return}if("ride_share"===c){if(!C.trim()||!_.trim()){em("Ingresa origen y destino");return}if(!T){em("Selecciona hora de salida");return}if(new Date(T)<=new Date){em("La hora de salida debe ser en el futuro");return}}if("express_errand"===c&&!U.trim()){em("Ingresa el nombre del negocio");return}ed(!0);try{let e;let t=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!t){em("Debes iniciar sesi\xf3n"),ed(!1);return}let a={category_id:h,description:b.trim(),lat:E,lng:O,offered_price:f?parseFloat(f):null,urgency:y,ttl_minutes:N,type:c,category_type:"ride_share"===c?"travel":"express_errand"===c?"errand":"fixed",workers_needed:Z,recurrence:et,...X?{scheduled_at:new Date(X).toISOString()}:{},..."custom"===et&&es.length>0?{recurrence_days:es}:{}};if("ride_share"===c?(a.travel_role=x,a.pickup_address=C.trim(),a.delivery_address=_.trim(),a.pickup_lat=E,a.pickup_lng=O,a.delivery_lat=L,a.delivery_lng=A,a.departure_time=new Date(T).toISOString(),a.seats=R,a.destination_name=J.trim()||_.trim(),a.payload={travel_role:x,seats:R,departure_time:new Date(T).toISOString(),destination_name:J.trim()||_.trim(),origin_address:C.trim(),destination_address:_.trim()}):"express_errand"===c&&(a.store_name=U.trim(),a.items_count=G?parseInt(G):null,a.load_type=W,a.requires_vehicle=H,a.payload={store_name:U.trim(),items_count:G?parseInt(G):null,load_type:W,requires_vehicle:H}),en){let s=new FormData;Object.entries(a).forEach(e=>{let[t,a]=e;null!=a&&("object"==typeof a&&"payload"===t?s.append(t,JSON.stringify(a)):s.append(t,String(a)))}),s.append("image",en),e={method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:s}}else e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(a)};let s=await (0,n.S)("/api/v1/demand/publish",e),r=await s.json();s.ok&&"success"===r.status?(em(""),setTimeout(()=>{o(),i()},300)):em(r.message||r.errors?JSON.stringify(r.errors):"Error al publicar demanda")}catch(e){em(e.message||"Error de conexi\xf3n")}finally{ed(!1)}},[ep,eh]=(0,r.useState)(!1);return(0,s.jsx)("div",{className:"fixed inset-0 z-[400] bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"\xbfQu\xe9 necesitas?"}),(0,s.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[ec&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded text-sm",children:ec}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["Categor\xeda ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(u,{categories:l,selectedId:h,onSelect:e=>g(e),placeholder:"\xbfQu\xe9 tipo de servicio?"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["\xbfQu\xe9 necesitas? ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("textarea",{value:b,onChange:e=>D(e.target.value),placeholder:"Describe brevemente lo que necesitas...",className:"w-full h-24 px-3 py-2 pr-10 border rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-amber-400",maxLength:500}),(0,s.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,s.jsx)(d,{onTranscript:e=>D(t=>t?t+" "+e:e)})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Precio ofrecido (CLP)"}),(0,s.jsx)("input",{type:"number",value:f,onChange:e=>j(e.target.value),placeholder:"Ej: 5000 (opcional)",className:"w-full px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-amber-400"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>eh(!ep),className:"w-full flex items-center justify-between px-3 py-2 rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold",children:[(0,s.jsx)("span",{children:"⚙️ Opciones avanzadas"}),(0,s.jsx)("span",{children:ep?"▲":"▼"})]}),ep&&(0,s.jsxs)("div",{className:"space-y-4 border border-slate-200 rounded-xl p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Tipo de servicio"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[["fixed_job","\uD83D\uDD27 Trabajo"],["ride_share","\uD83D\uDE97 Viaje"],["express_errand","\uD83D\uDCE6 Compra"]].map(e=>{let[t,a]=e;return(0,s.jsx)("button",{onClick:()=>m(t),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(c===t?"bg-amber-100 text-amber-700 ring-2 ring-amber-400":"bg-gray-100 text-gray-500"),children:a},t)})})]}),"ride_share"===c&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"Origen",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsx)("input",{type:"text",value:_,onChange:e=>{k(e.target.value),Q(e.target.value)},placeholder:"Destino",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsx)("input",{type:"datetime-local",value:T,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm"})]}),"express_errand"===c&&(0,s.jsx)("input",{type:"text",value:U,onChange:e=>M(e.target.value),placeholder:"Nombre del negocio",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Urgencia"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["low","medium","high"].map(e=>(0,s.jsx)("button",{onClick:()=>v(e),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(y===e?"bg-red-100 text-red-700 ring-2 ring-red-400":"bg-gray-100 text-gray-500"),children:"low"===e?"Baja":"medium"===e?"Media":"Alta"},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Foto (opcional)"}),ei?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:ei,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border"}),(0,s.jsx)("button",{onClick:()=>{el(null),eo(null)},className:"absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs font-bold",children:"\xd7"})]}):(0,s.jsxs)("label",{className:"flex items-center justify-center gap-2 w-full py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer text-sm text-gray-500",children:[(0,s.jsx)("span",{children:"\uD83D\uDCF7 Agregar foto"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(el(a),eo(URL.createObjectURL(a)))}})]})]})]}),(0,s.jsx)("button",{onClick:ex,disabled:eu||!h||!b.trim(),className:"w-full bg-amber-500 text-white py-3 rounded-xl font-bold text-sm hover:bg-amber-600 transition disabled:opacity-50 disabled:cursor-not-allowed",children:eu?"Publicando...":"✨ Publicar"})]})]})})}},1837:function(e,t,a){a.d(t,{S:function(){return r}});let s="https://jobshour.dondemorales.cl".replace(/\/api$/,"");async function r(e,t){return fetch(s?"".concat(s).concat(e):e,t)}}}]);