"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{8573:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=a(7437),r=a(2265),n=a(1837),l=a(166);let i={wrench:"\uD83D\uDD27",zap:"⚡",paintbrush:"\uD83C\uDFA8",sparkles:"✨",hammer:"\uD83D\uDD28",leaf:"\uD83C\uDF3F",key:"\uD83D\uDD11",building:"\uD83C\uDFD7️",scissors:"✂️","paw-print":"\uD83D\uDC3E",truck:"\uD83D\uDE9A","shopping-cart":"\uD83D\uDED2",car:"\uD83D\uDE97",baby:"\uD83D\uDC76","heart-handshake":"\uD83E\uDD1D",dog:"\uD83D\uDC15","graduation-cap":"\uD83C\uDF93",music:"\uD83C\uDFB5",hand:"\uD83D\uDC86",activity:"\uD83C\uDFC3",utensils:"\uD83C\uDF7D️","chef-hat":"\uD83D\uDC68‍\uD83C\uDF73",disc:"\uD83C\uDFA7",camera:"\uD83D\uDCF7",monitor:"\uD83D\uDCBB",wifi:"\uD83D\uDCF6",flame:"\uD83D\uDD25",rabbit:"\uD83D\uDC07",droplet:"\uD83D\uDCA7",droplets:"\uD83D\uDCA7","key-round":"\uD83D\uDD11","hard-hat":"\uD83D\uDC77",trees:"\uD83C\uDF33",home:"\uD83C\uDFE0",package:"\uD83D\uDCE6"};function o(e){return e&&i[e]||"\uD83D\uDCCB"}function u(e){let{categories:t,selectedId:a,onSelect:n,placeholder:l="Buscar categor\xeda...",multiple:i=!1,selectedIds:u=[],onSelectMultiple:c}=e,[d,m]=(0,r.useState)(""),[x,p]=(0,r.useState)(!1),h=(0,r.useRef)(null),b=(0,r.useRef)(null),g=t.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),D=t.find(e=>e.id===a);function f(e){i&&c?c(u.includes(e)?u.filter(t=>t!==e):[...u,e]):(n(e),p(!1),m(""))}return(0,r.useEffect)(()=>{function e(e){h.current&&!h.current.contains(e.target)&&p(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.jsxs)("div",{ref:h,className:"relative",children:[(0,s.jsxs)("div",{onClick:()=>{p(!x),setTimeout(()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.focus()},50)},className:"w-full px-3 py-2 border rounded-lg cursor-pointer flex items-center justify-between bg-white hover:border-gray-400 transition",children:[i?(0,s.jsx)("span",{className:"text-sm truncate",children:u.length>0?"".concat(u.length," categor\xeda").concat(u.length>1?"s":""," seleccionada").concat(u.length>1?"s":""):(0,s.jsx)("span",{className:"text-gray-400",children:l})}):(0,s.jsx)("span",{className:"text-sm truncate",children:D?(0,s.jsxs)("span",{children:[o(D.icon)," ",D.name]}):(0,s.jsx)("span",{className:"text-gray-400",children:l})}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition ".concat(x?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&u.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:u.map(e=>{let a=t.find(t=>t.id===e);return a?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs font-semibold px-2 py-1 rounded-full",style:{backgroundColor:(a.color||"#6b7280")+"20",color:a.color||"#6b7280"},children:[o(a.icon)," ",a.name,(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),f(e)},className:"ml-0.5 hover:opacity-70",children:"\xd7"})]},e):null})}),x&&(0,s.jsxs)("div",{className:"absolute z-50 mt-1 w-full bg-white border rounded-lg shadow-xl max-h-64 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-2 border-b sticky top-0 bg-white",children:(0,s.jsx)("input",{ref:b,type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"\uD83D\uDD0D Buscar...",className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-300",autoFocus:!0})}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-48",children:0===g.length?(0,s.jsx)("div",{className:"p-3 text-center text-gray-400 text-sm",children:"No se encontraron categor\xedas"}):g.map(e=>{let t=i?u.includes(e.id):e.id===a;return(0,s.jsxs)("button",{onClick:()=>f(e.id),className:"w-full flex items-center gap-2.5 px-3 py-2.5 text-left text-sm hover:bg-gray-50 transition ".concat(t?"bg-blue-50 font-bold":""),children:[(0,s.jsx)("span",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-base shrink-0",style:{backgroundColor:(e.color||"#6b7280")+"20"},children:o(e.icon)}),(0,s.jsx)("span",{className:"truncate",children:e.name}),t&&(0,s.jsx)("span",{className:"ml-auto text-blue-500 font-bold",children:"✓"})]},e.id)})})]})]})}let c=(0,l.default)(()=>a.e(740).then(a.bind(a,6740)),{loadableGenerated:{webpack:()=>[6740]},ssr:!1}),d=(0,l.default)(()=>a.e(523).then(a.bind(a,523)),{loadableGenerated:{webpack:()=>[523]},ssr:!1});function m(e){let{userLat:t,userLng:a,categories:l,onClose:i,onPublished:o}=e,[m,x]=(0,r.useState)("fixed_job"),[p,h]=(0,r.useState)("passenger"),[b,g]=(0,r.useState)(null),[D,f]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[v,N]=(0,r.useState)("medium"),[w,C]=(0,r.useState)(30),[S,_]=(0,r.useState)(""),[k,E]=(0,r.useState)(""),[F,O]=(0,r.useState)(t),[I,L]=(0,r.useState)(a),[B,A]=(0,r.useState)(null),[P,T]=(0,r.useState)(null),[z,R]=(0,r.useState)(""),[q,J]=(0,r.useState)(1),[Q,U]=(0,r.useState)(""),[G,M]=(0,r.useState)(""),[V,W]=(0,r.useState)(""),[$,H]=(0,r.useState)("medium"),[K,X]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)(""),[ee,et]=(0,r.useState)(1),[ea,es]=(0,r.useState)("once"),[er,en]=(0,r.useState)([]),[el,ei]=(0,r.useState)(null),[eo,eu]=(0,r.useState)(null),[ec,ed]=(0,r.useState)(!1),[em,ex]=(0,r.useState)("");(0,r.useEffect)(()=>{"fixed_job"===m&&g(null)},[m]),(0,r.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{O(e.coords.latitude),L(e.coords.longitude)},()=>{})},[]);let ep=async()=>{if(ex(""),!b){ex("Selecciona una categor\xeda");return}if(!D.trim()){ex("Ingresa una descripci\xf3n");return}if("ride_share"===m){if(!S.trim()||!k.trim()){ex("Ingresa origen y destino");return}if(!z){ex("Selecciona hora de salida");return}if(new Date(z)<=new Date){ex("La hora de salida debe ser en el futuro");return}}if("express_errand"===m&&!G.trim()){ex("Ingresa el nombre del negocio");return}ed(!0);try{let e;let t=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!t){ex("Debes iniciar sesi\xf3n"),ed(!1);return}let a={category_id:b,description:D.trim(),lat:F,lng:I,offered_price:j?parseFloat(j):null,urgency:v,ttl_minutes:w,type:m,category_type:"ride_share"===m?"travel":"express_errand"===m?"errand":"fixed",workers_needed:ee,recurrence:ea,...Y?{scheduled_at:new Date(Y).toISOString()}:{},..."custom"===ea&&er.length>0?{recurrence_days:er}:{}};if("ride_share"===m?(a.travel_role=p,a.pickup_address=S.trim(),a.delivery_address=k.trim(),a.pickup_lat=F,a.pickup_lng=I,a.delivery_lat=B,a.delivery_lng=P,a.departure_time=new Date(z).toISOString(),a.seats=q,a.destination_name=Q.trim()||k.trim(),a.payload={travel_role:p,seats:q,departure_time:new Date(z).toISOString(),destination_name:Q.trim()||k.trim(),origin_address:S.trim(),destination_address:k.trim()}):"express_errand"===m&&(a.store_name=G.trim(),a.items_count=V?parseInt(V):null,a.load_type=$,a.requires_vehicle=K,a.payload={store_name:G.trim(),items_count:V?parseInt(V):null,load_type:$,requires_vehicle:K}),el){let s=new FormData;Object.entries(a).forEach(e=>{let[t,a]=e;null!=a&&("object"==typeof a&&"payload"===t?s.append(t,JSON.stringify(a)):s.append(t,String(a)))}),s.append("image",el),e={method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:s}}else e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(a)};let s=await (0,n.S)("/api/v1/demand/publish",e),r=await s.json();s.ok&&"success"===r.status?(ex(""),setTimeout(()=>{o(),i()},300)):ex(r.message||r.errors?JSON.stringify(r.errors):"Error al publicar demanda")}catch(e){ex(e.message||"Error de conexi\xf3n")}finally{ed(!1)}},[eh,eb]=(0,r.useState)(!1);return(0,s.jsx)("div",{className:"fixed inset-0 z-[400] bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"\xbfQu\xe9 necesitas?"}),(0,s.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[em&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded text-sm",children:em}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["Categor\xeda ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(u,{categories:l,selectedId:b,onSelect:e=>g(e),placeholder:"\xbfQu\xe9 tipo de servicio?"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["\xbfQu\xe9 necesitas? ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("textarea",{value:D,onChange:e=>f(e.target.value),placeholder:"Describe brevemente lo que necesitas...",className:"w-full h-24 px-3 py-2 pr-10 border rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-amber-400",maxLength:500}),(0,s.jsx)("div",{className:"absolute bottom-2 right-2",children:(0,s.jsx)(c,{onTranscript:e=>f(t=>t?t+" "+e:e)})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Precio ofrecido (CLP)"}),(0,s.jsx)("input",{type:"number",value:j,onChange:e=>y(e.target.value),placeholder:"Ej: 5000 (opcional)",className:"w-full px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-amber-400"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>eb(!eh),className:"w-full flex items-center justify-between px-3 py-2 rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold",children:[(0,s.jsx)("span",{children:"⚙️ Opciones avanzadas"}),(0,s.jsx)("span",{children:eh?"▲":"▼"})]}),eh&&(0,s.jsxs)("div",{className:"space-y-4 border border-slate-200 rounded-xl p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Tipo de servicio"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[["fixed_job","\uD83D\uDD27 Trabajo"],["ride_share","\uD83D\uDE97 Viaje"],["express_errand","\uD83D\uDCE6 Compra"]].map(e=>{let[t,a]=e;return(0,s.jsx)("button",{onClick:()=>x(t),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(m===t?"bg-amber-100 text-amber-700 ring-2 ring-amber-400":"bg-gray-100 text-gray-500"),children:a},t)})})]}),"ride_share"===m&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d,{value:S,onChange:_,onSelect:(e,t,a)=>{_(e),O(t),L(a)},placeholder:"Origen"}),(0,s.jsx)(d,{value:k,onChange:e=>{E(e),U(e)},onSelect:(e,t,a)=>{E(e),U(e),A(t),T(a)},placeholder:"Destino"}),(0,s.jsx)("input",{type:"datetime-local",value:z,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm"})]}),"express_errand"===m&&(0,s.jsx)("input",{type:"text",value:G,onChange:e=>M(e.target.value),placeholder:"Nombre del negocio",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Urgencia"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["low","medium","high"].map(e=>(0,s.jsx)("button",{onClick:()=>N(e),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(v===e?"bg-red-100 text-red-700 ring-2 ring-red-400":"bg-gray-100 text-gray-500"),children:"low"===e?"Baja":"medium"===e?"Media":"Alta"},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Foto (opcional)"}),eo?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:eo,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border"}),(0,s.jsx)("button",{onClick:()=>{ei(null),eu(null)},className:"absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs font-bold",children:"\xd7"})]}):(0,s.jsxs)("label",{className:"flex items-center justify-center gap-2 w-full py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer text-sm text-gray-500",children:[(0,s.jsx)("span",{children:"\uD83D\uDCF7 Agregar foto"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(ei(a),eu(URL.createObjectURL(a)))}})]})]})]}),(0,s.jsx)("button",{onClick:ep,disabled:ec||!b||!D.trim(),className:"w-full bg-amber-500 text-white py-3 rounded-xl font-bold text-sm hover:bg-amber-600 transition disabled:opacity-50 disabled:cursor-not-allowed",children:ec?"Publicando...":"✨ Publicar"})]})]})})}},1837:function(e,t,a){a.d(t,{S:function(){return r}});let s="https://jobshour.dondemorales.cl".replace(/\/api$/,"");async function r(e,t){return fetch(s?"".concat(s).concat(e):e,t)}}}]);