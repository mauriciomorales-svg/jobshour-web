"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{2649:function(e,s,t){t.r(s),t.d(s,{default:function(){return c}});var a=t(7437),r=t(2265);function l(e){let{review:s,canRespond:t=!1,onRespond:r}=e;return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,a.jsx)("img",{src:s.reviewer.avatar||"https://i.pravatar.cc/60?u=".concat(s.reviewer.name),alt:s.reviewer.name,className:"w-10 h-10 rounded-full object-cover"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("p",{className:"font-bold text-gray-900 text-sm",children:s.reviewer.name}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:s.created_at})]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(e=>(0,a.jsx)("svg",{className:"w-4 h-4 ".concat(e<=s.stars?"text-yellow-400 fill-current":"text-gray-300"),fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},e))})]})]}),s.comment&&(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:s.comment})}),s.response&&(0,a.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs font-bold text-blue-700",children:"Respuesta del trabajador"}),s.responded_at&&(0,a.jsx)("span",{className:"text-xs text-blue-500",children:s.responded_at})]}),(0,a.jsx)("p",{className:"text-sm text-blue-900",children:s.response})]}),t&&!s.response&&r&&(0,a.jsx)("button",{onClick:()=>r(s.id),className:"text-xs text-blue-600 hover:text-blue-700 font-semibold",children:"Responder rese\xf1a"})]})}function n(e){let{isOpen:s,onClose:t,reviewId:l,onSent:n}=e,[c,i]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[x,m]=(0,r.useState)(null),h=async()=>{if(c.trim().length<10){m("La respuesta debe tener al menos 10 caracteres");return}d(!0),m(null);try{let e=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!e){m("Debes iniciar sesi\xf3n para responder"),d(!1);return}let s=await fetch("/api/v1/reviews/".concat(l,"/respond"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({response:c.trim()})}),a=await s.json();s.ok&&"success"===a.status?(n(),t(),i("")):m(a.message||"Error al enviar la respuesta")}catch(e){m("Error de conexi\xf3n. Por favor intenta nuevamente.")}finally{d(!1)}};return s?(0,a.jsx)("div",{className:"fixed inset-0 z-[900] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-[90%] max-w-md mx-4 overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6",children:[(0,a.jsx)("h3",{className:"text-white font-bold text-lg",children:"Responder Rese\xf1a"}),(0,a.jsx)("p",{className:"text-white/90 text-sm mt-1",children:"Tu respuesta ser\xe1 visible p\xfablicamente"})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tu respuesta (m\xednimo 10 caracteres) *"}),(0,a.jsx)("textarea",{value:c,onChange:e=>i(e.target.value),placeholder:"Agradece al cliente o aclara cualquier punto...",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none resize-none",rows:4,maxLength:500}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 caracteres"]})]}),x&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:x})})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200 flex gap-3",children:[(0,a.jsx)("button",{onClick:t,disabled:o,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition disabled:opacity-50",children:"Cancelar"}),(0,a.jsx)("button",{onClick:h,disabled:o||c.trim().length<10,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-bold hover:from-blue-600 hover:to-indigo-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Enviando..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"\uD83D\uDCAC"}),(0,a.jsx)("span",{children:"Publicar Respuesta"})]})})]})]})}):null}function c(e){let{workerId:s,showAverage:t=!0,canRespond:c=!1}=e,[i,o]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[m,h]=(0,r.useState)(0),[u,b]=(0,r.useState)(0),[p,g]=(0,r.useState)("all"),[j,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{v()},[s]);let v=async()=>{x(!0);try{let e=localStorage.getItem("auth_token")||localStorage.getItem("token"),t=await fetch("/api/v1/workers/".concat(s,"/reviews"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}}),a=await t.json();if("success"===a.status&&Array.isArray(a.data)){let e=[...a.data];if("recent"===p||("best"===p?e=e.sort((e,s)=>s.stars-e.stars):"worst"===p&&(e=e.sort((e,s)=>e.stars-s.stars))),o(e),e.length>0){let s=e.reduce((e,s)=>e+s.stars,0)/e.length;h(s),b(e.length)}}}catch(e){console.error("Error fetching reviews:",e)}finally{x(!1)}};return((0,r.useEffect)(()=>{v()},[p]),d)?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Cargando rese\xf1as..."})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[t&&u>0&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-4 border border-yellow-200",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Calificaci\xf3n Promedio"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-3xl font-black text-yellow-600",children:m.toFixed(1)}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(e=>(0,a.jsx)("svg",{className:"w-5 h-5 ".concat(e<=Math.round(m)?"text-yellow-400 fill-current":"text-gray-300"),fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},e))})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[u," rese\xf1a",1!==u?"s":""]})]})})}),i.length>0&&(0,a.jsx)("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:[{key:"all",label:"Todas"},{key:"recent",label:"Recientes"},{key:"best",label:"Mejores"},{key:"worst",label:"Peores"}].map(e=>{let{key:s,label:t}=e;return(0,a.jsx)("button",{onClick:()=>g(s),className:"px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap transition ".concat(p===s?"bg-yellow-400 text-white shadow-lg":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:t},s)})}),0===i.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[(0,a.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),(0,a.jsx)("p",{className:"text-gray-500 font-semibold",children:"A\xfan no hay rese\xf1as"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"S\xe9 el primero en calificar este trabajador"})]}):(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,a.jsx)(l,{review:e,canRespond:c,onRespond:f},e.id))}),j&&(0,a.jsx)(n,{isOpen:!!j,onClose:()=>f(null),reviewId:j,onSent:()=>{f(null),v()}})]})}}}]);