(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1692:function(e,t,a){Promise.resolve().then(a.bind(a,7992))},7992:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R}});var s=a(7437),r=a(2265),o=a(166),l=a(9596),n=a(6410);let i=e=>{(0,r.useEffect)(()=>{if(console.log("[useNotifications] effect triggered, apiToken exists:",!!e),!e){console.log("[useNotifications] no apiToken, skipping");return}console.log("[useNotifications] calling setupNotifications..."),(0,n.setupNotifications)(e).then(()=>{console.log("[useNotifications] setupNotifications completed")}).catch(e=>{console.error("[useNotifications] setupNotifications failed:",e)}),(0,n.Lu)()},[e])},c={success:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}),error:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})}),warning:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})}),info:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},d={success:{bg:"bg-white border-l-4 border-green-500",icon:"text-green-500 bg-green-50",bar:"bg-green-500"},error:{bg:"bg-white border-l-4 border-red-500",icon:"text-red-500 bg-red-50",bar:"bg-red-500"},warning:{bg:"bg-white border-l-4 border-amber-500",icon:"text-amber-500 bg-amber-50",bar:"bg-amber-500"},info:{bg:"bg-white border-l-4 border-blue-500",icon:"text-blue-500 bg-blue-50",bar:"bg-blue-500"}};function u(e){var t;let{toast:a,onRemove:o}=e,[l,n]=(0,r.useState)(!1),i=null!==(t=a.duration)&&void 0!==t?t:3500,u=d[a.type];return(0,r.useEffect)(()=>{requestAnimationFrame(()=>n(!0));let e=setTimeout(()=>{n(!1),setTimeout(()=>o(a.id),300)},i);return()=>clearTimeout(e)},[]),(0,s.jsxs)("div",{className:"relative flex items-start gap-3 ".concat(u.bg," rounded-2xl shadow-lg shadow-black/10 px-4 py-3.5 min-w-[280px] max-w-[340px] overflow-hidden transition-all duration-300 ").concat(l?"translate-y-0 opacity-100":"translate-y-4 opacity-0"),children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-xl flex items-center justify-center shrink-0 ".concat(u.icon),children:c[a.type]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 pt-0.5",children:[(0,s.jsx)("p",{className:"text-sm font-bold text-gray-900 leading-tight",children:a.title}),a.body&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 leading-snug",children:a.body})]}),(0,s.jsx)("button",{onClick:()=>{n(!1),setTimeout(()=>o(a.id),300)},className:"shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition mt-0.5",children:(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 h-0.5 ".concat(u.bar," rounded-full"),style:{animation:"shrink ".concat(i,"ms linear forwards")}}),(0,s.jsx)("style",{children:"@keyframes shrink { from { width: 100% } to { width: 0% } }"})]})}function x(e){let{toasts:t,onRemove:a}=e;return(0,s.jsx)("div",{className:"fixed top-4 right-4 z-[999] flex flex-col gap-2 pointer-events-none",children:t.map(e=>(0,s.jsx)("div",{className:"pointer-events-auto",children:(0,s.jsx)(u,{toast:e,onRemove:a})},e.id))})}let m=e=>(0,s.jsx)("svg",{className:"w-6 h-6",fill:e?"currentColor":"none",stroke:"currentColor",strokeWidth:e?0:2,viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),h=e=>(0,s.jsx)("svg",{className:"w-6 h-6",fill:e?"currentColor":"none",stroke:"currentColor",strokeWidth:e?0:2,viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),p=e=>(0,s.jsx)("svg",{className:"w-6 h-6",fill:e?"currentColor":"none",stroke:"currentColor",strokeWidth:e?0:2,viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),g=e=>(0,s.jsx)("svg",{className:"w-6 h-6",fill:e?"currentColor":"none",stroke:"currentColor",strokeWidth:e?0:2,viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})});function b(e){let{active:t,onChange:a,requestsBadge:r=0,demandsBadge:o=0,isWorker:l=!1}=e;return(0,s.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-[90] bg-white/95 backdrop-blur-md border-t border-gray-200 shadow-[0_-4px_24px_rgba(0,0,0,0.08)]",children:(0,s.jsx)("div",{className:"flex items-stretch pb-safe",children:[{key:"map",label:"Mapa",icon:m},{key:"feed",label:l?"Oportunidades":"Demandas",icon:h,badge:o},{key:"requests",label:"Solicitudes",icon:p,badge:r},{key:"profile",label:"Perfil",icon:g}].map(e=>{var r;let o=t===e.key;return(0,s.jsxs)("button",{onClick:()=>a(e.key),className:"flex-1 flex flex-col items-center justify-center py-2.5 gap-0.5 relative transition-all duration-150 active:scale-95 ".concat(o?"text-blue-600":"text-gray-400 hover:text-gray-600"),children:[o&&(0,s.jsx)("span",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-8 h-0.5 bg-blue-600 rounded-full"}),(0,s.jsxs)("div",{className:"relative",children:[e.icon(o),(null!==(r=e.badge)&&void 0!==r?r:0)>0&&(0,s.jsx)("span",{className:"absolute -top-1.5 -right-2 bg-red-500 text-white text-[9px] font-black rounded-full min-w-[16px] h-4 flex items-center justify-center px-1 shadow",children:e.badge>9?"9+":e.badge})]}),(0,s.jsx)("span",{className:"text-[10px] font-semibold leading-none ".concat(o?"text-blue-600":"text-gray-400"),children:e.label})]},e.key)})})})}let f=[{status:"inactive",label:"Invisible",sublabel:"No apareces en el mapa",color:{border:"border-slate-600/50",bg:"bg-slate-800/60",glow:"",dot:"bg-slate-500",text:"text-slate-400",active:{border:"border-slate-400",bg:"bg-slate-700",glow:"shadow-[0_0_28px_rgba(148,163,184,0.35)]",text:"text-slate-200"}}},{status:"intermediate",label:"Disponibilidad Flexible",sublabel:"Visible a 5 km \xb7 con aviso previo",color:{border:"border-sky-500/30",bg:"bg-sky-950/40",glow:"",dot:"bg-sky-700",text:"text-sky-600",active:{border:"border-sky-400",bg:"bg-sky-900/60",glow:"shadow-[0_0_32px_rgba(56,189,248,0.45)]",text:"text-sky-200"}}},{status:"active",label:"Disponibilidad Inmediata",sublabel:"Visible en todo el mapa",color:{border:"border-emerald-500/30",bg:"bg-emerald-950/40",glow:"",dot:"bg-emerald-700",text:"text-emerald-600",active:{border:"border-emerald-400",bg:"bg-emerald-900/60",glow:"shadow-[0_0_36px_rgba(52,211,153,0.5)]",text:"text-emerald-200"}}}];function v(e){let{current:t,loading:a,onSelect:o,onClose:l}=e;(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l]);let n="guest"===t?"inactive":t;return(0,s.jsxs)("div",{className:"fixed inset-0 z-[200] flex items-end justify-start",onClick:l,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative mb-[76px] ml-4 animate-fade-in-up",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"relative w-[120px] rounded-[2.5rem] bg-gradient-to-b from-slate-800 to-slate-950 p-4 shadow-[0_0_60px_rgba(0,0,0,0.9),inset_0_2px_2px_rgba(255,255,255,0.05)] border border-slate-700/40",children:[(0,s.jsx)("div",{className:"flex flex-col gap-5 py-1",children:f.map(e=>{let t=e.status===n,r=t?e.color.active:e.color;return(0,s.jsxs)("button",{disabled:!!a,onClick:()=>{o(e.status),l()},className:"group relative flex flex-col items-center focus:outline-none",children:[t&&(0,s.jsx)("div",{className:"absolute inset-0 scale-125 rounded-full blur-2xl opacity-60 ".concat("inactive"===e.status?"bg-slate-500/20":"intermediate"===e.status?"bg-sky-500/20":"bg-emerald-500/20"," ").concat(t?"animate-pulse":"")}),(0,s.jsxs)("div",{className:"relative h-16 w-16 rounded-full border-2 overflow-hidden transition-all duration-300 ".concat(r.border," ").concat(t?e.color.active.bg+" "+e.color.active.glow:e.color.bg," ").concat(t?"":"opacity-40 group-hover:opacity-70 group-hover:scale-105"),children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b ".concat("inactive"===e.status?"from-slate-400/15":"intermediate"===e.status?"from-sky-400/25":"from-emerald-400/30"," to-transparent")}),(0,s.jsx)("div",{className:"absolute top-2 left-3 h-4 w-7 rounded-full bg-white/10 blur-[2px] -rotate-12"}),t&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"h-8 w-8 rounded-full blur-xl ".concat("inactive"===e.status?"bg-slate-300/30":"intermediate"===e.status?"bg-sky-300/40":"bg-emerald-300/50"," animate-pulse")})})]}),(0,s.jsxs)("div",{className:"absolute left-[72px] top-1/2 -translate-y-1/2 w-36 text-left pointer-events-none",children:[(0,s.jsx)("p",{className:"text-[10px] font-black tracking-wide leading-tight ".concat(t?r.text:e.color.text," transition-colors"),children:e.label}),(0,s.jsx)("p",{className:"text-[9px] leading-tight mt-0.5 ".concat(t?"text-white/60":"text-slate-600"," transition-colors"),children:e.sublabel})]})]},e.status)})}),(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:(0,s.jsx)("span",{className:"text-[8px] font-black tracking-[0.3em] text-slate-600 uppercase italic",children:"JobsHours"})})]}),(0,s.jsx)("div",{className:"mx-auto h-6 w-3 bg-gradient-to-b from-slate-700 to-transparent opacity-50 rounded-b-sm"})]})]})}let j={guest:{dot:"bg-gray-300",pill:"bg-gray-900/80 text-white border border-white/10 backdrop-blur-sm",label:"Gana dinero extra",sublabel:"Inicia sesi\xf3n para activarte"},inactive:{dot:"bg-gray-400",pill:"bg-slate-800/90 text-slate-300 border border-slate-600/50 backdrop-blur-sm",label:"Invisible en mapa",sublabel:"Toca para cambiar estado"},intermediate:{dot:"bg-sky-300 animate-pulse",pill:"bg-sky-500/90 text-white border border-sky-300/60 backdrop-blur-sm shadow-[0_0_16px_rgba(56,189,248,0.4)]",label:"Disponibilidad Flexible",sublabel:"Visible a 5 km \xb7 con aviso previo"},active:{dot:"bg-green-400 animate-pulse",pill:"bg-green-600/90 text-white border border-green-400/60 backdrop-blur-sm shadow-[0_0_16px_rgba(34,197,94,0.4)]",label:"Disponibilidad Inmediata",sublabel:"Visible en todo el mapa"}};function w(e){let{status:t,loading:a,isLoggedIn:o,onActivate:l,onChangeTo:n,onShowLogin:i}=e,[c,d]=(0,r.useState)(!1),u="guest"===t&&o?"inactive":t,x=j[u];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>{if(!a){if(!o){i();return}d(!0)}},disabled:!!a,className:"flex items-center gap-2.5 px-4 py-2.5 rounded-2xl shadow-lg transition-all active:scale-95 ".concat(x.pill," ").concat(a?"opacity-60 cursor-not-allowed":"cursor-pointer hover:brightness-110"),children:[(0,s.jsx)("span",{className:"w-2.5 h-2.5 rounded-full shrink-0 ".concat(x.dot)}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-xs font-black leading-tight",children:a?"Actualizando...":x.label}),!a&&(0,s.jsx)("p",{className:"text-[10px] opacity-60 leading-tight",children:x.sublabel})]}),a?(0,s.jsxs)("svg",{className:"w-3.5 h-3.5 animate-spin shrink-0 opacity-60",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):(0,s.jsx)("span",{className:"text-base leading-none shrink-0 opacity-70",children:"\uD83D\uDEA6"})]}),c&&(0,s.jsx)(v,{current:u,loading:a,onSelect:e=>{if("active"===e){l();return}n(e)},onClose:()=>d(!1)})]})}let k=(0,o.default)(()=>Promise.all([a.e(641),a.e(212),a.e(161)]).then(a.bind(a,4161)),{loadableGenerated:{webpack:()=>[4161]},ssr:!1}),y=(0,o.default)(()=>a.e(278).then(a.bind(a,3268)),{loadableGenerated:{webpack:()=>[3268]},ssr:!1}),N=(0,o.default)(()=>a.e(215).then(a.bind(a,9215)),{loadableGenerated:{webpack:()=>[9215]},ssr:!1}),C=(0,o.default)(()=>Promise.all([a.e(398),a.e(552)]).then(a.bind(a,8552)),{loadableGenerated:{webpack:()=>[8552]},ssr:!1});(0,o.default)(()=>a.e(579).then(a.bind(a,6579)),{loadableGenerated:{webpack:()=>[6579]},ssr:!1});let _=(0,o.default)(()=>a.e(318).then(a.bind(a,3318)),{loadableGenerated:{webpack:()=>[3318]},ssr:!1}),D=(0,o.default)(()=>a.e(576).then(a.bind(a,1576)),{loadableGenerated:{webpack:()=>[1576]},ssr:!1}),S=(0,o.default)(()=>Promise.all([a.e(398),a.e(289)]).then(a.bind(a,7689)),{loadableGenerated:{webpack:()=>[7689]},ssr:!1}),L=(0,o.default)(()=>a.e(249).then(a.bind(a,249)),{loadableGenerated:{webpack:()=>[249]},ssr:!1}),I=(0,o.default)(()=>a.e(776).then(a.bind(a,9820)),{loadableGenerated:{webpack:()=>[9820]},ssr:!1}),M=(0,o.default)(()=>a.e(686).then(a.bind(a,6686)),{loadableGenerated:{webpack:()=>[6686]},ssr:!1}),E=(0,o.default)(()=>a.e(281).then(a.bind(a,4281)),{loadableGenerated:{webpack:()=>[4281]},ssr:!1}),z=(0,o.default)(()=>a.e(573).then(a.bind(a,8573)),{loadableGenerated:{webpack:()=>[8573]},ssr:!1}),P=(0,o.default)(()=>a.e(375).then(a.bind(a,7375)),{loadableGenerated:{webpack:()=>[7375]},ssr:!1}),T=(0,o.default)(()=>a.e(757).then(a.bind(a,2649)),{loadableGenerated:{webpack:()=>[2649]},ssr:!1}),A=(0,o.default)(()=>a.e(728).then(a.bind(a,2728)),{loadableGenerated:{webpack:()=>[2728]},ssr:!1}),B={wrench:"\uD83D\uDD27",zap:"⚡",paintbrush:"\uD83C\uDFA8",sparkles:"\uD83E\uDDF9",hammer:"\uD83E\uDEB5",leaf:"\uD83C\uDF3F",key:"\uD83D\uDD11",building:"\uD83E\uDDF1",scissors:"\uD83E\uDDF5","paw-print":"\uD83D\uDC3E","shopping-bag":"\uD83D\uDECD️",truck:"\uD83D\uDE9A",package:"\uD83D\uDCE6"};function F(e){return"$"+e.toLocaleString("es-CL")}let V="https://jobshour.dondemorales.cl".replace(/\/api$/,"");function R(){let[e,t]=(0,r.useState)([]),[o,n]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null),[g,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1),[R,W]=(0,r.useState)(""),[H,q]=(0,r.useState)(!1),[U,O]=(0,r.useState)(!1),[G,J]=(0,r.useState)(null),[K,X]=(0,r.useState)([]),[$,Z]=(0,r.useState)(!1),[Y,Q]=(0,r.useState)({}),[ee,et]=(0,r.useState)(null),[ea,es]=(0,r.useState)(!0),[er,eo]=(0,r.useState)(null),[el,en]=(0,r.useState)(0),[ei,ec]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)(!0),[ex,em]=(0,r.useState)(!1),[eh,ep]=(0,r.useState)(0),[eg,eb]=(0,r.useState)(null),[ef,ev]=(0,r.useState)(!1),[ej,ew]=(0,r.useState)(!1),[ek,ey]=(0,r.useState)("map"),[eN,eC]=(0,r.useState)(null),[e_,eD]=(0,r.useState)(!1),[eS,eL]=(0,r.useState)(!1),[eI,eM]=(0,r.useState)(!1),[eE,ez]=(0,r.useState)(null),[eP,eT]=(0,r.useState)(!1),[eA,eB]=(0,r.useState)(!1),[eF,eV]=(0,r.useState)(!1),[eR,eW]=(0,r.useState)(null),[eH,eq]=(0,r.useState)(null),[eU,eO]=(0,r.useState)(!1),[eG,eJ]=(0,r.useState)([]),[eK,eX]=(0,r.useState)(!1),[e$,eZ]=(0,r.useState)("guest"),eY=(0,r.useRef)("guest"),[eQ,e0]=(0,r.useState)("map"),[e1,e2]=(0,r.useState)(!1),{toasts:e3,toast:e5,removeToast:e4}=function(){let[e,t]=(0,r.useState)([]);return{toasts:e,toast:(0,r.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o="".concat(Date.now(),"-").concat(Math.random());t(t=>[...t,{id:o,title:e,type:a,body:s,duration:r}])},[]),removeToast:(0,r.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[])}}(),e6=localStorage.getItem("auth_token");i(eg?e6:null),(0,r.useEffect)(()=>{eY.current=e$},[e$]);let[e8,e7]=(0,r.useState)(-37.6672),[e9,te]=(0,r.useState)(-72.573),[tt,ta]=(0,r.useState)(null),ts=(0,r.useRef)(new Set),tr=(0,r.useRef)(new Set),to=(0,r.useRef)(null);(0,r.useEffect)(()=>(window.mapRef=to,()=>{delete window.mapRef}),[]);let[tl,tn]=(0,r.useState)(null),ti=(0,r.useCallback)(()=>(localStorage.getItem("auth_token")||localStorage.getItem("token"))&&eg?eg.avatarUrl&&eg.name&&"Usuario"!==eg.name?{canInteract:!0}:{canInteract:!1,reason:"profile"}:{canInteract:!1,reason:"login"},[eg]),tc=(0,r.useCallback)(async e=>{try{var t;let a=await fetch("".concat(V,"/api/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok){localStorage.removeItem("auth_token"),eb(null),eZ("guest");return}let s=await a.json();eb({id:s.id,name:s.name||"Usuario",firstName:(s.name||"Usuario").split(" ")[0],avatarUrl:s.avatar||(null===(t=s.worker)||void 0===t?void 0:t.avatar)||null,provider:s.provider||"email",token:e});let r="onboarding_done_".concat(s.id),o="true"===localStorage.getItem(r);if(td(e),o)return;let l=localStorage.getItem("worker_intent");s.worker?(void 0!==s.worker.profile_completed?s.worker.profile_completed:s.worker.category_id&&s.worker.hourly_rate)?localStorage.setItem(r,"true"):(setTimeout(()=>ew(!0),300),l&&localStorage.removeItem("worker_intent")):("activate"===l||"register"===l)&&(setTimeout(()=>ew(!0),300),localStorage.removeItem("worker_intent")),eZ(e=>"guest"!==e?e:"inactive"),eY.current="guest"===e$?"inactive":e$}catch(e){localStorage.removeItem("auth_token"),eb(null),eZ("guest")}},[]),td=(0,r.useCallback)(async e=>{try{let a=await fetch("".concat(V,"/api/v1/worker/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){var t;let e=await a.json();(null===(t=e.data)||void 0===t?void 0:t.categories)&&eJ(e.data.categories.map(e=>e.id))}}catch(e){console.error("Error fetching worker data:",e)}},[]);(0,r.useEffect)(()=>{if(!window.Capacitor)return;let e=()=>{},t=()=>{};return Promise.all([a.e(689),a.e(90)]).then(a.bind(a,9090)).then(t=>{let{Browser:a}=t;a.addListener("browserFinished",async()=>{let e=localStorage.getItem("pending_auth_key");if(e){localStorage.removeItem("pending_auth_key");try{let t=await fetch("https://jobshour.dondemorales.cl/api/auth/mobile-token?key=".concat(e));if(t.ok){let e=await t.json();e.token&&(localStorage.setItem("auth_token",e.token),tc(e.token))}}catch(e){console.error("Error recuperando token:",e)}}}).then(t=>{e=t.remove})}),Promise.all([a.e(689),a.e(663)]).then(a.bind(a,663)).then(e=>{let{App:a}=e;a.addListener("appUrlOpen",async e=>{try{let t=new URL(e.url);if(e.url.startsWith("jobshour://auth-success")){let e=t.searchParams.get("key");if(!e)return;let a=await fetch("https://jobshour.dondemorales.cl/api/auth/mobile-token?key=".concat(e));if(a.ok){let e=await a.json();e.token&&(localStorage.setItem("auth_token",e.token),tc(e.token))}return}let a=t.searchParams.get("token");a&&(localStorage.setItem("auth_token",a),tc(a))}catch(e){console.error("Error parsing deep link:",e)}}).then(e=>{t=e.remove})}),()=>{e(),t()}},[tc]),(0,r.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("token"),a=e.get("login"),s=localStorage.getItem("worker_intent");if(t&&"success"===a)localStorage.setItem("auth_token",t),window.history.replaceState({},"",window.location.pathname),tc(t),"activate"===s&&localStorage.removeItem("worker_intent");else{let e=localStorage.getItem("auth_token");if(e)tc(e);else{let e=localStorage.getItem("saved_email"),t=localStorage.getItem("saved_password");e&&t&&fetch("".concat(V,"/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(e=>e.json()).then(e=>{e.token&&(localStorage.setItem("auth_token",e.token),tc(e.token))}).catch(()=>{})}}},[tc]),(0,r.useEffect)(()=>{let e=localStorage.getItem("auth_token");if(!eg||!e)return;let t=(e,t)=>{if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0},a=()=>{fetch("".concat(V,"/api/v1/requests/mine"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json()).then(a=>{var s;let r=null!==(s=null==a?void 0:a.data)&&void 0!==s?s:[],o=r.filter(e=>["pending","accepted","in_progress"].includes(e.status)).map(e=>e.id).filter(e=>"number"==typeof e).sort((e,t)=>t-e).slice(0,5);X(e=>t(e,o)?e:o),console.log("[ChatNotify] sync active request ids",o);let l=o[0];"number"==typeof l&&l!==G&&J(l),r.filter(e=>"completed"===e.status).forEach(t=>{let a="rated_".concat(t.id);!localStorage.getItem(a)&&t.worker&&fetch("".concat(V,"/api/v1/workers/").concat(t.worker.id,"/reviews"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json()).then(e=>{var a;(null===(a=e.data)||void 0===a?void 0:a.some(e=>e.service_request_id===t.id))||setTimeout(()=>{eW(t.id),eq({name:t.worker.name||"Trabajador",avatar:t.worker.avatar}),eV(!0)},2e3)}).catch(()=>{setTimeout(()=>{var e,a;eW(t.id),eq({name:(null===(e=t.worker)||void 0===e?void 0:e.name)||"Trabajador",avatar:(null===(a=t.worker)||void 0===a?void 0:a.avatar)||null}),eV(!0)},2e3)})})}).catch(e=>{console.error("[ChatNotify] sync failed",e)})};a();let s=setInterval(a,8e3);return()=>clearInterval(s)},[eg,G]),(0,r.useEffect)(()=>{if(!(null==eg?void 0:eg.id))return;let e=null,t=!0;return Promise.all([a.e(11),a.e(426)]).then(a.bind(a,2426)).then(a=>{var s,r,o;let{getEcho:l}=a;if(!t||!(e=l()))return;let n=null==e?void 0:null===(s=e.connector)||void 0===s?void 0:s.pusher,i=(e,t)=>{e5(e,"info",t,7e3);try{"Notification"in window&&"granted"===Notification.permission&&new Notification(e,{body:t||"",icon:"/icon-192x192.png"})}catch(e){}};try{"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().catch(()=>{})}catch(e){}let c=e.private("worker.".concat(eg.id)),d=e.private("user.".concat(eg.id));try{let e="private-worker.".concat(eg.id),t="private-user.".concat(eg.id),a=null==n?void 0:null===(r=n.channel)||void 0===r?void 0:r.call(n,e),s=null==n?void 0:null===(o=n.channel)||void 0===o?void 0:o.call(n,t);null==a||a.bind("pusher:subscription_succeeded",()=>console.log("[Notifications] subscription_succeeded",{channel:e})),null==a||a.bind("pusher:subscription_error",t=>console.error("[Notifications] subscription_error",{channel:e,status:t})),null==s||s.bind("pusher:subscription_succeeded",()=>console.log("[Notifications] subscription_succeeded",{channel:t})),null==s||s.bind("pusher:subscription_error",e=>console.error("[Notifications] subscription_error",{channel:t,status:e}))}catch(e){console.error("[Notifications] Failed to bind subscription events",e)}c.listen(".request.new",e=>{console.log("[Notifications] .request.new",e);let t=null==e?void 0:e.id;"number"==typeof t&&J(t),i("Nueva solicitud",(null==e?void 0:e.description)?String(e.description):"Tienes una nueva solicitud")}).listen(".request.updated",e=>{console.log("[Notifications] .request.updated (worker)",e),i("Solicitud actualizada",(null==e?void 0:e.status)?"Estado: ".concat(e.status):"Una solicitud fue actualizada")}),d.listen(".request.updated",e=>{console.log("[Notifications] .request.updated (user)",e),i("Actualizaci\xf3n de solicitud",(null==e?void 0:e.status)?"Estado: ".concat(e.status):"Tu solicitud fue actualizada")})}),()=>{if(t=!1,e)try{e.leave("worker.".concat(eg.id)),e.leave("user.".concat(eg.id))}catch(e){}}},[null==eg?void 0:eg.id]),(0,r.useEffect)(()=>{let e=null,s=!0;return Promise.all([a.e(11),a.e(426)]).then(a.bind(a,2426)).then(a=>{let{getEcho:r}=a;s&&(e=r())&&e.channel("workers").listen(".worker.updated",e=>{if(!(null==e?void 0:e.worker_id)||e.user_id&&(null==eg?void 0:eg.id)&&e.user_id===eg.id)return;let a="intermediate"===e.status?"intermediate":"inactive"===e.status?"inactive":e.is_active?"active":"inactive";t(t=>t.map(t=>t.id!==e.worker_id||"demand"===t.pin_type?t:{...t,status:a,pos:e.lat&&e.lng?{lat:e.lat,lng:e.lng}:t.pos})),tu(e8,e9)})}),()=>{if(s=!1,e)try{e.leave("workers")}catch(e){}}},[e8,e9]);let tu=(0,r.useCallback)(async(e,t)=>{try{let a=await fetch("".concat(V,"/api/v1/experts/count?lat=").concat(e,"&lng=").concat(t,"&radius=10"));if(!a.ok)return;let s=await a.json();ta({count:s.count,label:s.label})}catch(e){}},[]);(0,r.useEffect)(()=>{tu(e8,e9);let e=setInterval(()=>tu(e8,e9),45e3);return()=>clearInterval(e)},[e8,e9,tu]),(0,r.useEffect)(()=>{if(!(null==eg?void 0:eg.id)||!K.length)return;let e=null,t=!0,s=ts.current,r=tr.current;return Promise.all([a.e(11),a.e(426)]).then(a.bind(a,2426)).then(a=>{let{getEcho:o}=a;if(!t||!(e=o()))return;let l=e=>{var t;let a=null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e,r=null==a?void 0:a.id,o=null==a?void 0:a.sender_id;if("number"!=typeof r||s.has(r)||(s.add(r),o===eg.id||!(!$||"undefined"!=typeof document&&document.hidden)))return;let l=(null==a?void 0:a.body)?String(a.body):"Nuevo mensaje";console.log("[ChatNotify] message.new",{id:r}),e5("Nuevo mensaje","info",l,5e3);try{"Notification"in window&&"granted"===Notification.permission&&new Notification("Nuevo mensaje",{body:l,icon:"/icon-192x192.png"})}catch(e){}};K.forEach(t=>{r.has(t)||(r.add(t),console.log("[ChatNotify] subscribing",{channel:"private-chat.".concat(t)}),e.private("chat.".concat(t)).listen(".message.new",l))})}),()=>{if(t=!1,e)try{K.forEach(t=>e.leave("chat.".concat(t)))}catch(e){}}},[null==eg?void 0:eg.id,K,$]),(0,r.useEffect)(()=>{let e=()=>{fetch("".concat(V,"/api/v1/nudges/random")).then(e=>{if(!e.ok)throw Error("HTTP ".concat(e.status));return e.json()}).then(e=>{e.message&&(es(!1),setTimeout(()=>{et(e.message),es(!0)},300))}).catch(e=>{console.error("Error fetching nudge:",e)})};e();let t=setInterval(e,12e3);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{fetch("".concat(V,"/api/v1/categories")).then(e=>{if(!e.ok)throw Error("HTTP ".concat(e.status));return e.json()}).then(e=>{n(Array.isArray(e)?e:[])}).catch(e=>{console.error("Error fetching categories:",e)})},[]);let tx=(0,r.useRef)({lastCall:0,timeoutId:null}),tm=(0,r.useCallback)(e=>{let a=Date.now(),s=a-tx.current.lastCall;if(s<2e3&&0!==tx.current.lastCall){tx.current.timeoutId&&clearTimeout(tx.current.timeoutId);let t=2e3-s;console.log("⏭️ fetchNearby: throttling ".concat(Math.round(t),"ms")),tx.current.timeoutId=setTimeout(()=>{tx.current.timeoutId=null,tx.current.lastCall=0,tm(e)},t);return}tx.current.timeoutId&&(clearTimeout(tx.current.timeoutId),tx.current.timeoutId=null),tx.current.lastCall=a,m(!0);let r=localStorage.getItem("auth_token")||localStorage.getItem("token"),o=e9||-72.573,l=new URLSearchParams({lat:String(e8||-37.6672),lng:String(o)});e&&l.append("categories[]",String(e));let n={"Content-Type":"application/json"};r&&(n.Authorization="Bearer ".concat(r)),Promise.all([fetch("".concat(V,"/api/v1/experts/nearby?").concat(l),{headers:n}).then(e=>e.ok?e.json():Promise.reject(Error("HTTP ".concat(e.status)))),fetch("".concat(V,"/api/v1/demand/nearby?").concat(l),{headers:n}).then(e=>e.ok?e.json():Promise.reject(Error("HTTP ".concat(e.status)))).catch(()=>({data:[],meta:{}}))]).then(e=>{var a,s,r;let[o,l]=e,n=(null!==(a=o.data)&&void 0!==a?a:[]).map(e=>({...e,pin_type:"worker",active_route:e.active_route||null,user_id:e.user_id||null})),i=(null!==(s=l.data)&&void 0!==s?s:[]).map(e=>{var t,a;return{id:e.id,pos:e.pos,name:e.client_name,avatar:e.client_avatar,price:e.offered_price,category_color:e.category_color,category_slug:e.category_slug,category_name:e.category_name,fresh_score:0,status:"demand",pin_type:"demand",urgency:e.urgency,travel_role:null!==(t=e.travel_role)&&void 0!==t?t:null,payload:null!==(a=e.payload)&&void 0!==a?a:null,description:e.description,distance_km:e.distance_km}});eg&&n.length>0&&!n.find(e=>e.user_id&&e.user_id===eg.id||e.id&&e.id===eg.id)&&"inactive"!==e$&&console.warn("⚠️ Usuario no visible en mapa. Estado:",e$),t([...n,...i]),d(null!==(r=o.meta)&&void 0!==r?r:null),m(!1)}).catch(e=>{console.error("Error fetching experts/demands:",e),m(!1)})},[e8,e9,eg]);(0,r.useEffect)(()=>{let e=localStorage.getItem("user_lat"),t=localStorage.getItem("user_lng");if(e&&t)e7(parseFloat(e)),te(parseFloat(t));else{let e=setTimeout(()=>eX(!0),2e3);return()=>clearTimeout(e)}},[]),(0,r.useEffect)(()=>{tm()},[]);let th=(()=>{let t=e;eg&&"inactive"===e$&&(t=t.filter(e=>!(e.user_id&&e.user_id===eg.id||e.id&&e.id===eg.id)));let a=R.trim().toLowerCase();return!a||(null==c?void 0:c.city)&&c.city.toLowerCase().includes(a)?t:t.filter(e=>e.name.toLowerCase().includes(a)||e.category_slug&&e.category_slug.toLowerCase().includes(a))})(),tp=e=>{let t=h===e?null:e;p(t),f(null),tm(t)},tg=async e=>{j(!0),f(null);try{let i=localStorage.getItem("auth_token")||localStorage.getItem("token"),c={Accept:"application/json"};if(i&&(c.Authorization="Bearer ".concat(i)),"demand"===e.pin_type){let i;let d="/api/v1/demand/".concat(e.id);console.log("\uD83D\uDCE1 Fetching demand:",d);let u=await fetch(d,{headers:c});if(!u.ok){let e=await u.text();throw console.error("❌ Error HTTP:",u.status,e),Error("Error ".concat(u.status,": ").concat(u.statusText))}try{i=await u.json()}catch(e){throw console.error("❌ Error parseando JSON:",e),Error("La respuesta del servidor no es v\xe1lida")}if(i.data){var t,a,s,r,o,l,n;f({id:i.data.id,name:(null===(t=i.data.client)||void 0===t?void 0:t.name)||"Cliente",nickname:null,avatar:(null===(a=i.data.client)||void 0===a?void 0:a.avatar)||null,client_id:(null===(s=i.data.client)||void 0===s?void 0:s.id)||i.data.client_id||null,phone:(null===(r=i.data.client)||void 0===r?void 0:r.phone)||null,title:i.data.description||"Sin descripci\xf3n",bio:"",skills:[],hourly_rate:i.data.offered_price||0,fresh_score:0,fresh_score_count:0,rating_count:0,total_jobs:0,is_verified:!1,status:"demand",category:i.data.category||{name:"Sin categor\xeda",color:"#6b7280",slug:"",icon:""},videos_count:0,pos:i.data.pos||e.pos,travel_role:null!==(l=i.data.travel_role)&&void 0!==l?l:null,payload:null!==(n=i.data.payload)&&void 0!==n?n:null,microcopy:"Demanda: ".concat(i.data.description||"Sin descripci\xf3n")}),console.log("✅ Detail cargado:",null===(o=i.data.client)||void 0===o?void 0:o.name)}else console.warn("⚠️ No hay data en la respuesta:",i)}else{let t;let a="/api/v1/experts/".concat(e.id);console.log("\uD83D\uDCE1 Fetching expert:",a);let s=await fetch(a,{headers:c});if(!s.ok){let e=await s.text();throw console.error("❌ Error HTTP:",s.status,e),Error("Error ".concat(s.status,": ").concat(s.statusText))}try{t=await s.json()}catch(e){throw console.error("❌ Error parseando JSON:",e),Error("La respuesta del servidor no es v\xe1lida")}t.data&&(f(t.data),console.log("✅ Detail cargado:",t.data.name))}}catch(e){console.error("❌ Error fetching detail:",e),e5(e instanceof Error?e.message:"Error al cargar los detalles","error")}j(!1),console.log("\uD83C\uDFC1 Loading detail finalizado")};th.filter(e=>"active"===e.status).length,th.filter(e=>"intermediate"===e.status).length,(0,r.useEffect)(()=>{let e=setInterval(()=>en(e=>(e+1)%5),1e4),t=setInterval(()=>ep(e=>(e+1)%4),25e3);return()=>{clearInterval(e),clearInterval(t)}},[]);let tb=(0,r.useCallback)(()=>{f(null),j(!1)},[]),tf=(0,r.useCallback)(e=>{if(e0(e),"map"===e&&(eu(!0),em(!1),ey("map")),"feed"===e&&(eu(!1),em(!1),ey("map")),"requests"===e&&(eu(!0),em(!0),ey("map")),"profile"===e){if(!eg){ev(!0);return}ey("profile")}},[eg]),tv=(0,r.useCallback)(async e=>{let a=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!a){ev(!0);return}if("active"===e&&0===eG.length){eO(!0);return}let s="intermediate"===e?"listening":e;e2(!0);try{let r=await fetch("".concat(V,"/api/v1/worker/status"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({status:s,lat:e8||-37.67,lng:e9||-72.57,categories:"active"===e?eG:void 0})}),o=await r.json();"success"===o.status?(eZ(e),eg&&t(t=>t.map(t=>(t.user_id&&t.user_id===eg.id||t.id===eg.id)&&"demand"!==t.pin_type?{...t,status:e}:t)),tm(h),e5({active:"\uD83D\uDFE2 Disponibilidad Inmediata activada",intermediate:"\uD83D\uDD35 Disponibilidad Flexible activada",inactive:"⚫ Te desconectaste del mapa"}[e],"inactive"===e?"info":"success")):e5(o.message||"Error al actualizar estado","error")}catch(e){e5("Error de conexi\xf3n","error")}finally{e2(!1)}},[eG,e8,e9,h,tm,e5]);return(0,s.jsxs)("div",{className:"h-screen w-screen overflow-hidden relative",children:["profile"===ek&&eg&&(0,s.jsx)(C,{user:eg,onClose:()=>ey("map"),onCategorySelected:()=>{let e=localStorage.getItem("auth_token");e&&td(e)}}),"jobs"===ek&&eg&&(0,s.jsx)(D,{user:eg,onClose:()=>ey("map")}),eP&&(0,s.jsx)(E,{onClose:()=>eT(!1)}),eA&&(0,s.jsx)(z,{userLat:e8,userLng:e9,categories:o,onClose:()=>eB(!1),onPublished:()=>{e5("Demanda publicada","success","Aparecer\xe1 en el mapa en unos segundos."),setTimeout(()=>{if(tm(),ei){let e=new Event("reload-feed");window.dispatchEvent(e)}},1e3)}}),(0,s.jsx)("div",{className:"absolute inset-0 pt-[180px] pb-[68px]",children:(0,s.jsx)(k,{ref:to,points:th,onPointClick:tg,onMapClick:tb,highlightedId:tl})}),(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 z-[100] pointer-events-none",children:[(0,s.jsx)("div",{className:"bg-slate-950/95 backdrop-blur-md border-b border-slate-800 px-4 py-2.5 pointer-events-auto",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("button",{onClick:()=>q(!H),className:"w-9 h-9 flex items-center justify-center bg-slate-800 hover:bg-slate-700 rounded-xl text-slate-300 transition active:scale-95","aria-label":"Men\xfa",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,s.jsxs)("div",{className:"flex items-center font-black tracking-tight text-2xl leading-none gap-1",children:[(0,s.jsx)("span",{className:"text-white",children:"Jobs"}),(0,s.jsxs)("span",{className:"text-teal-400 flex items-center",children:[(0,s.jsx)("span",{children:"H"}),(0,s.jsxs)("span",{className:"relative inline-flex items-center justify-center mx-0.5",style:{width:28,height:28},children:[(0,s.jsx)("span",{className:"absolute inset-0 rounded-full border-[3px] border-teal-400 shadow-[0_0_10px_rgba(45,212,191,0.35)]"}),(0,s.jsx)("span",{className:"clock-hand-long",style:{position:"absolute",bottom:"50%",left:"50%",width:"2.5px",height:"42%",background:"linear-gradient(to top,#5eead4,#fbbf24)",borderRadius:"2px",transformOrigin:"bottom center"}}),(0,s.jsx)("span",{className:"clock-hand-short",style:{position:"absolute",bottom:"50%",left:"50%",width:"2.5px",height:"28%",background:"#f1f5f9",borderRadius:"2px",transformOrigin:"bottom center"}}),(0,s.jsx)("span",{className:"rounded-full bg-amber-400 z-10",style:{position:"relative",width:5,height:5}})]}),(0,s.jsx)("span",{children:"urs"})]})]}),eg?(0,s.jsxs)("button",{onClick:()=>q(!0),className:"flex items-center gap-2 pr-3 pl-1 py-1 bg-slate-800 hover:bg-slate-700 rounded-xl transition active:scale-95",children:[eg.avatarUrl?(0,s.jsx)("img",{src:eg.avatarUrl,className:"w-7 h-7 rounded-lg object-cover",alt:eg.firstName}):(0,s.jsx)("div",{className:"w-7 h-7 rounded-lg bg-teal-500 flex items-center justify-center text-white font-black text-sm",children:eg.firstName.charAt(0).toUpperCase()}),(0,s.jsx)("span",{className:"text-xs font-bold text-slate-300 max-w-[60px] truncate",children:eg.firstName})]}):(0,s.jsxs)("button",{onClick:()=>ev(!ef),className:"flex items-center gap-1.5 px-3.5 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-xl text-xs font-bold transition active:scale-95 shadow-[0_0_12px_rgba(45,212,191,0.3)]",children:["Ingresar",(0,s.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})]})]})}),(0,s.jsx)("div",{className:"bg-slate-900/90 backdrop-blur-md border-b border-slate-800 px-4 py-2.5 pointer-events-auto",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center bg-slate-800 rounded-xl px-3.5 py-2 border border-slate-700",children:[(0,s.jsx)("svg",{className:"w-4 h-4 text-teal-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar servicios cercanos...",value:R,onChange:e=>W(e.target.value),className:"flex-1 bg-transparent outline-none text-sm text-slate-200 placeholder:text-slate-500 ml-2.5"}),R&&(0,s.jsx)("button",{onClick:()=>W(""),className:"text-slate-500 hover:text-slate-300 ml-2 transition",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),null!==tt&&(0,s.jsxs)("span",{className:"shrink-0 inline-flex items-center gap-1 px-2.5 py-1.5 bg-teal-500/15 border border-teal-500/30 rounded-full text-xs font-bold text-teal-400",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-teal-400 animate-pulse inline-block"}),tt.label]})]})}),!1,(0,s.jsx)("div",{className:"bg-slate-900/80 backdrop-blur-md px-4 py-2 pointer-events-auto border-b border-slate-800/50",children:(0,s.jsx)("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:o.map(e=>(0,s.jsxs)("button",{onClick:()=>tp(e.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ".concat(h===e.id?"bg-teal-500/25 text-teal-300 border border-teal-400/40 shadow-[0_0_8px_rgba(45,212,191,0.15)]":"bg-slate-800/80 text-slate-400 hover:bg-slate-700 border border-slate-700"),children:[(0,s.jsx)("span",{className:"text-sm",children:B[e.icon]||"\uD83D\uDCCC"}),(0,s.jsx)("span",{children:e.name}),e.active_count>0&&(0,s.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full ".concat(h===e.id?"bg-teal-400/20 text-teal-300":"bg-slate-700 text-slate-500"),children:e.active_count})]},e.id))})})]}),ef&&!eg&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-[298] bg-black/40 backdrop-blur-sm",onClick:()=>ev(!1)}),(0,s.jsx)("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[299] w-80 animate-slide-up",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-[0_12px_40px_rgba(0,0,0,0.18)] border border-slate-100 p-5",children:[(0,s.jsxs)("div",{className:"text-center mb-4",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg",children:(0,s.jsx)("svg",{className:"w-7 h-7 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,s.jsx)("h3",{className:"text-base font-black text-slate-800 mb-1",children:"\xa1\xdanete a JobsHour!"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 leading-relaxed",children:"Inicia sesi\xf3n para solicitar servicios, conectar con trabajadores cerca de ti y acceder a todas las funciones"})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("button",{type:"button",onClick:async e=>{e.preventDefault(),e.stopPropagation();let{openExternalBrowser:t}=await a.e(16).then(a.bind(a,2016)),s=(await a.e(689).then(a.bind(a,6689))).Capacitor.isNativePlatform();await t(s?"https://jobshour.dondemorales.cl/api/auth/google?mobile=true":"https://jobshour.dondemorales.cl/api/auth/google")},className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl border border-slate-200 hover:bg-slate-50 text-sm text-slate-700 font-semibold transition hover:shadow-sm",children:[(0,s.jsxs)("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,s.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,s.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,s.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,s.jsx)("span",{children:"Continuar con Google"})]})}),(0,s.jsx)("p",{className:"text-[9px] text-slate-400 text-center mt-3",children:"R\xe1pido, seguro y sin contrase\xf1as"})]})})]}),(g||v)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-[108] bg-black/30 backdrop-blur-[2px]",onClick:()=>{f(null),j(!1)}}),(0,s.jsx)("div",{className:"fixed left-0 right-0 z-[109] bottom-[68px] animate-slide-up",children:(0,s.jsxs)("div",{className:"bg-white rounded-t-3xl shadow-[0_-12px_48px_rgba(0,0,0,0.22)] max-h-[72vh] overflow-y-auto",children:[(0,s.jsx)("div",{className:"flex justify-center pt-3 pb-1",children:(0,s.jsx)("div",{className:"w-10 h-1 bg-gray-200 rounded-full"})}),v&&!g?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 gap-3",children:[(0,s.jsx)("div",{className:"animate-spin w-8 h-8 border-[3px] border-green-500 border-t-transparent rounded-full"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Cargando perfil..."})]}):g&&(()=>{var e,t,a,r,o,l,n,i,c;let d=(null===(e=g.category)||void 0===e?void 0:e.color)||"#6b7280",u="demand"===g.status;return(0,s.jsxs)("div",{className:"pb-6",children:[(0,s.jsxs)("div",{className:"px-5 pt-4 pb-5 relative",style:{background:"linear-gradient(135deg, ".concat(d,"15 0%, ").concat(d,"05 100%)")},children:[(0,s.jsxs)("div",{className:"absolute top-3 right-4 flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold",style:{background:"".concat(d,"25"),color:d},children:[(0,s.jsx)("span",{children:(null===(t=g.category)||void 0===t?void 0:t.icon)&&B[g.category.icon]||"⚙️"}),(0,s.jsx)("span",{children:(null===(a=g.category)||void 0===a?void 0:a.name)||"General"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,s.jsxs)("div",{className:"relative shrink-0",children:[(0,s.jsx)("div",{className:"w-20 h-20 rounded-2xl overflow-hidden",style:{border:"3px solid ".concat(d,"60"),boxShadow:"0 8px 24px ".concat(d,"30")},children:(0,s.jsx)("img",{src:g.avatar||"https://i.pravatar.cc/150?u=".concat(g.id),alt:g.name,className:"w-full h-full object-cover"})}),(0,s.jsx)("span",{className:"absolute -bottom-1 -right-1 w-5 h-5 border-2 border-white rounded-full shadow-md ".concat("active"===g.status?"bg-green-500 animate-pulse":"intermediate"===g.status?"bg-sky-400 animate-pulse":u?"bg-amber-400":"bg-gray-300")})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("h3",{className:"font-black text-gray-900 text-lg leading-tight",children:g.name}),eg&&g.user_id&&eg.id===g.user_id&&(0,s.jsx)("span",{className:"text-[10px] font-black bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full",children:"T\xfa"}),u&&g.client_id&&(null==eg?void 0:eg.id)===g.client_id&&(0,s.jsx)("span",{className:"text-[10px] font-black bg-orange-100 text-orange-600 px-1.5 py-0.5 rounded-full",children:"(yo)"}),g.is_verified&&(0,s.jsx)("svg",{className:"w-4 h-4 text-blue-500 shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})]}),g.nickname&&(0,s.jsxs)("p",{className:"text-xs text-gray-400 font-medium mt-0.5",children:["@",g.nickname]}),(0,s.jsxs)("div",{className:"flex items-center gap-2.5 mt-2 flex-wrap",children:[(0,s.jsxs)("span",{className:"font-black text-xl",style:{color:d},children:[F(g.hourly_rate),(0,s.jsx)("span",{className:"text-xs font-semibold text-gray-400",children:"/hr"})]}),g.fresh_score>0&&(0,s.jsxs)("span",{className:"flex items-center gap-1 bg-orange-50 px-2 py-0.5 rounded-full",children:[(0,s.jsx)("svg",{className:"w-3 h-3 fill-orange-400",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),(0,s.jsx)("span",{className:"text-xs font-bold text-orange-700",children:g.fresh_score})]}),g.total_jobs>0&&(0,s.jsxs)("span",{className:"text-xs text-gray-400 font-semibold",children:[g.total_jobs," trabajos"]}),g.showcase_video&&(0,s.jsx)("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-bold",children:"\uD83D\uDCF9 Video"})]})]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-full ".concat("active"===g.status?"bg-green-500 text-white":"intermediate"===g.status?"bg-sky-500 text-white":u?"bg-amber-400 text-white":"bg-gray-200 text-gray-500"),children:[(0,s.jsx)("span",{className:"w-1.5 h-1.5 rounded-full ".concat("active"===g.status?"bg-white animate-pulse":"intermediate"===g.status?"bg-white animate-pulse":u?"bg-white":"bg-gray-400")}),"active"===g.status?"Disp. Inmediata":"intermediate"===g.status?"Disp. Flexible":u?"Demanda activa":"No disponible"]})})]}),g.microcopy&&(0,s.jsx)("div",{className:"px-5 py-3 border-t border-gray-50",children:(0,s.jsxs)("p",{className:"text-sm text-gray-500 italic leading-relaxed",children:['"',g.microcopy,'"']})}),g.travel_role&&(0,s.jsxs)("div",{className:"mx-5 mt-3 rounded-2xl p-3.5 border ".concat("driver"===g.travel_role?"bg-emerald-50 border-emerald-200":"bg-blue-50 border-blue-200"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("span",{className:"text-lg",children:"driver"===g.travel_role?"\uD83D\uDE97":"\uD83D\uDE4B"}),(0,s.jsx)("span",{className:"text-sm font-bold ".concat("driver"===g.travel_role?"text-emerald-800":"text-blue-800"),children:"driver"===g.travel_role?"Ofrece transporte":"Busca transporte"}),(null===(r=g.payload)||void 0===r?void 0:r.seats)&&(0,s.jsxs)("span",{className:"ml-auto text-xs px-2 py-0.5 rounded-full font-bold ".concat("driver"===g.travel_role?"bg-emerald-200 text-emerald-800":"bg-blue-200 text-blue-800"),children:[g.payload.seats," ","driver"===g.travel_role?"asientos libres":"asientos necesarios"]})]}),(0,s.jsxs)("div",{className:"space-y-1 text-xs",children:[(null===(o=g.payload)||void 0===o?void 0:o.origin_address)&&(0,s.jsxs)("p",{className:"driver"===g.travel_role?"text-emerald-700":"text-blue-700",children:["\uD83D\uDCCD Desde: ",(0,s.jsx)("span",{className:"font-semibold",children:g.payload.origin_address})]}),((null===(l=g.payload)||void 0===l?void 0:l.destination_address)||(null===(n=g.payload)||void 0===n?void 0:n.destination_name))&&(0,s.jsxs)("p",{className:"driver"===g.travel_role?"text-emerald-700":"text-blue-700",children:["\uD83C\uDFC1 Hacia: ",(0,s.jsx)("span",{className:"font-semibold",children:g.payload.destination_address||g.payload.destination_name})]}),(null===(i=g.payload)||void 0===i?void 0:i.departure_time)&&(0,s.jsxs)("p",{className:"driver"===g.travel_role?"text-emerald-700":"text-blue-700",children:["\uD83D\uDD50 Salida: ",(0,s.jsx)("span",{className:"font-semibold",children:new Date(g.payload.departure_time).toLocaleString("es-CL",{dateStyle:"short",timeStyle:"short"})})]})]})]}),!g.travel_role&&(null===(c=g.active_route)||void 0===c?void 0:c.available_seats)&&g.active_route.available_seats>0&&(0,s.jsxs)("div",{className:"mx-5 mt-3 bg-blue-50 border border-blue-200 rounded-2xl p-3.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDE97"}),(0,s.jsx)("span",{className:"text-sm font-bold text-blue-800",children:"Modo Viaje Activo"}),(0,s.jsxs)("span",{className:"ml-auto text-xs bg-blue-200 text-blue-800 px-2 py-0.5 rounded-full font-bold",children:[g.active_route.available_seats," asientos"]})]}),g.active_route.destination&&(0,s.jsxs)("p",{className:"text-xs text-blue-700",children:["Hacia: ",(0,s.jsx)("span",{className:"font-semibold",children:g.active_route.destination.address})]})]}),(()=>{let e=!!(eg&&g.user_id&&eg.id===g.user_id),t="demand"===g.status,a=t&&!!g.travel_role,r=t&&g.client_id===(null==eg?void 0:eg.id),o=async()=>{let e=ti();if(!e.canInteract){ev(!0),e5("login"===e.reason?"Inicia sesi\xf3n para continuar":"Completa tu perfil","info");return}let t=localStorage.getItem("auth_token")||localStorage.getItem("token");try{let e=await fetch("".concat(V,"/api/v1/demand/").concat(g.id,"/take"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}),a=await e.json();e.ok&&"success"===a.status?(e5("driver"===g.travel_role?"\uD83D\uDE4B Solicitud enviada al chofer":"\uD83D\uDE97 Te ofreciste como chofer","success"),f(null),tm(h)):e5(a.message||"Error al conectar","error")}catch(e){e5("Error de conexi\xf3n","error")}};return(0,s.jsx)("div",{className:"px-5 mt-4",children:e||r?(0,s.jsxs)("button",{onClick:()=>ey("profile"),className:"w-full flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3.5 rounded-2xl text-sm font-bold transition active:scale-95",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Mi perfil"]}):a?(0,s.jsxs)("div",{className:"space-y-2.5",children:[(0,s.jsx)("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 py-3.5 rounded-2xl text-sm font-bold transition active:scale-95 ".concat("driver"===g.travel_role?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:"driver"===g.travel_role?"\uD83D\uDE4B Solicitar unirse al viaje":"\uD83D\uDE97 Ofrecerme como chofer"}),(0,s.jsxs)("a",{href:"https://www.google.com/maps/dir/?api=1&destination=".concat(g.pos.lat,",").concat(g.pos.lng),target:"_blank",rel:"noopener noreferrer",className:"w-full flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-2xl text-sm font-semibold transition active:scale-95",children:[(0,s.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Ver en mapa"]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2.5",children:[t?(0,s.jsxs)("a",{href:"https://www.google.com/maps/dir/?api=1&destination=".concat(g.pos.lat,",").concat(g.pos.lng),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 text-blue-700 py-3 rounded-2xl text-sm font-bold transition active:scale-95",children:[(0,s.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"C\xf3mo llegar"]}):(0,s.jsxs)("button",{onClick:()=>{ez(g.id),eM(!0)},className:"flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 rounded-2xl text-sm font-bold transition active:scale-95",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Ver perfil"]}),"inactive"===g.status?(0,s.jsx)("button",{disabled:!0,className:"flex items-center justify-center gap-2 bg-gray-100 text-gray-400 py-3 rounded-2xl text-sm font-bold cursor-not-allowed",children:"No disponible"}):G?(0,s.jsx)("button",{onClick:()=>{if(!ti().canInteract){ev(!0);return}Z(!0)},className:"flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white py-3 rounded-2xl text-sm font-bold transition active:scale-95",children:"\uD83D\uDCAC Chat activo"}):(0,s.jsx)("button",{onClick:()=>{let e=ti();if(!e.canInteract){ev(!0),e5("login"===e.reason?"Inicia sesi\xf3n para continuar":"Completa tu perfil","login"===e.reason?"info":"warning");return}O(!0)},className:"flex items-center justify-center gap-2 py-3 rounded-2xl text-sm font-bold transition active:scale-95 ".concat("active"===g.status?"bg-green-500 hover:bg-green-600 text-white":"bg-amber-400 hover:bg-amber-500 text-white"),children:"active"===g.status?"⚡ Solicitar ahora":"\uD83D\uDCAC Consultar"}),g.phone&&(0,s.jsxs)("button",{onClick:()=>{if(!ti().canInteract){ev(!0),e5("Inicia sesi\xf3n para ver el tel\xe9fono","info");return}window.open("tel:".concat(g.phone),"_self")},className:"col-span-2 flex items-center justify-center gap-2 bg-purple-50 hover:bg-purple-100 border border-purple-200 text-purple-700 py-3 rounded-2xl text-sm font-bold transition active:scale-95",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),"Llamar ahora"]})]})})})()]})})()]})})]}),(0,s.jsx)("div",{className:"fixed inset-0 z-[150] transition-all duration-500 ease-out ".concat(ed?"translate-y-full opacity-0 pointer-events-none":"translate-y-0 opacity-100 pointer-events-auto"),children:(0,s.jsxs)("div",{className:"bg-slate-900 h-full w-full overflow-hidden flex flex-col shadow-2xl",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-slate-900 px-4 pt-4 pb-3 border-b border-slate-700/50 z-10 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-black text-white",children:"Demandas"}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:"Solicitudes reales que puedes tomar ahora"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>{console.log("\uD83D\uDD04 Forzando recarga del feed..."),t([]),tm();let e=new Event("reload-feed");window.dispatchEvent(e),e5("Feed recargado","info")},className:"w-8 h-8 bg-blue-600 hover:bg-blue-700 rounded-lg flex items-center justify-center transition",title:"Recargar feed",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,s.jsx)("button",{onClick:()=>{eu(!0),e0("map")},className:"w-8 h-8 bg-slate-800 hover:bg-slate-700 rounded-lg flex items-center justify-center transition border border-slate-700",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(M,{userLat:-37.6672,userLng:-72.573,currentUserId:null==eg?void 0:eg.id,onCardClick:e=>{to.current&&to.current.flyTo([e.pos.lat,e.pos.lng],18).catch(console.error),tn(e.id),setTimeout(()=>tn(null),3e3),f(null)},highlightedRequestId:tl,onRequestService:e=>{console.log('\uD83D\uDD18 Bot\xf3n "Tomar Solicitud" clickeado:',e);let a=ti();if(!a.canInteract){"login"===a.reason?(ev(!0),e5("Inicia sesi\xf3n para tomar solicitudes","info")):(ew(!0),e5("Completa tu perfil para continuar","warning"));return}if(e.worker_id){console.log("\uD83D\uDCE1 Obteniendo detalle del worker:",e.worker_id);let t=localStorage.getItem("auth_token")||localStorage.getItem("token"),a={Accept:"application/json"};t&&(a.Authorization="Bearer ".concat(t)),fetch("".concat(V,"/api/v1/experts/").concat(e.worker_id),{headers:a}).then(e=>{if(!e.ok)throw Error("HTTP ".concat(e.status));return e.json()}).then(e=>{if(console.log("✅ Detalle del worker obtenido:",null==e?void 0:e.data),null==e?void 0:e.data)f(e.data),O(!0),eu(!0),console.log("✅ Modal abierto con detalle del worker");else throw Error("No data en respuesta")}).catch(t=>{var a,s,r,o,l,n;console.error("❌ Error fetching worker detail:",t);let i={id:e.worker_id||e.id,name:(null===(a=e.client)||void 0===a?void 0:a.name)||"Cliente",nickname:null,avatar:(null===(s=e.client)||void 0===s?void 0:s.avatar)||null,phone:null,title:e.description||"",bio:"",skills:[],hourly_rate:e.offered_price||0,fresh_score:0,fresh_score_count:0,rating_count:0,total_jobs:0,is_verified:!1,status:"active",category:e.category?{slug:(null===(r=e.category)||void 0===r?void 0:r.slug)||"",name:(null===(o=e.category)||void 0===o?void 0:o.name)||"Servicio",color:(null===(l=e.category)||void 0===l?void 0:l.color)||"#6b7280",icon:(null===(n=e.category)||void 0===n?void 0:n.icon)||"\uD83D\uDCCC"}:{slug:"",name:"Servicio",color:"#6b7280",icon:"\uD83D\uDCCC"},videos_count:0,pos:e.pos,microcopy:e.description||""};console.log("⚠️ Usando detalle de fallback:",i),f(i),O(!0),eu(!0)})}else{console.log("\uD83D\uDCCB Request sin worker_id - Es una demanda p\xfablica, tomando directamente");let a=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!a){ev(!0),e5("Inicia sesi\xf3n para tomar demandas","info");return}console.log("\uD83D\uDCE1 Enviando POST a /take_demand.php?id="+e.id),fetch("/take_demand.php?id=".concat(e.id),{method:"POST",headers:{Authorization:"Bearer ".concat(a),Accept:"application/json"}}).then(e=>(console.log("\uD83D\uDCE5 Respuesta HTTP:",e.status,e.ok),e.json())).then(a=>{if(console.log("\uD83D\uDCE6 Datos recibidos:",a),"success"===a.status){e5("Demanda tomada","success","El cliente ser\xe1 notificado.");let a=new CustomEvent("remove-feed-item",{detail:{id:e.id}});window.dispatchEvent(a),t(t=>t.filter(t=>!(t.id===e.id&&"demand"===t.pin_type))),f(null),setTimeout(()=>{tm();let e=new Event("reload-feed");window.dispatchEvent(e)},1500),eu(!0)}else e5(a.message||"Error al tomar demanda","error")}).catch(e=>{console.error("Error tomando demanda:",e),e5("Error de conexi\xf3n al tomar demanda","error")})}},onOpenChat:e=>{var t,a;let s=ti();if(!s.canInteract){"login"===s.reason?(ev(!0),e5("Inicia sesi\xf3n para chatear","info")):(ew(!0),e5("Completa tu perfil para chatear","warning"));return}J(e.id),Q({description:null==e?void 0:e.description,name:null==e?void 0:null===(t=e.client)||void 0===t?void 0:t.name,avatar:null==e?void 0:null===(a=e.client)||void 0===a?void 0:a.avatar}),Z(!0),eu(!0)},onGoToLocation:async e=>{var t,a,s;let r=null===(t=e.pos)||void 0===t?void 0:t.lat,o=null===(a=e.pos)||void 0===a?void 0:a.lng,l=localStorage.getItem("auth_token")||localStorage.getItem("token");if(l&&e.id)try{let t={Accept:"application/json"};l&&(t.Authorization="Bearer ".concat(l));let a=await fetch("".concat(V,"/api/v1/demand/").concat(e.id),{headers:t});if(a.ok){let e=await a.json();"success"===e.status&&(null===(s=e.data)||void 0===s?void 0:s.pos)&&(r=e.data.pos.lat,o=e.data.pos.lng)}}catch(e){}!r||!o||isNaN(r)||isNaN(o)||(eu(!0),console.log("\uD83D\uDDFA️ Ver en mapa: targetLat="+r+" targetLng="+o),setTimeout(()=>{let t=window.__leafletMap;console.log("\uD83D\uDDFA️ __leafletMap:",!!t),t&&"function"==typeof t.flyTo?(t.invalidateSize(),t.flyTo([r,o],18,{duration:1.5}),tn(e.id),setTimeout(()=>tn(null),3e3),console.log("✅ flyTo ejecutado")):console.error("❌ No se encontr\xf3 instancia del mapa")},400))}})})]})}),ex&&(0,s.jsx)("div",{className:"fixed inset-0 z-[150]",children:(0,s.jsx)(P,{user:eg,onLoginRequest:()=>{em(!1),ev(!0)},onClose:()=>{em(!1),e0("map")},onOpenChat:e=>{em(!1),J(e),Z(!0)}})}),eK&&(0,s.jsx)("div",{className:"fixed bottom-20 left-4 right-4 z-[180] animate-slide-up",children:(0,s.jsx)("div",{className:"bg-slate-900 border border-slate-700/50 rounded-2xl p-4 shadow-2xl shadow-teal-500/10 max-w-md mx-auto",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-teal-500/20 rounded-full flex items-center justify-center shrink-0 mt-0.5",children:(0,s.jsxs)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-white text-sm font-bold",children:eg?"".concat(eg.firstName,", veamos qu\xe9 hay cerca"):"Descubre servicios cerca de ti"}),(0,s.jsx)("p",{className:"text-slate-400 text-xs mt-0.5",children:"Compartir tu ubicaci\xf3n nos ayuda a mostrarte oportunidades cercanas"}),(0,s.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,s.jsxs)("button",{onClick:()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{e7(e.coords.latitude),te(e.coords.longitude),localStorage.setItem("user_lat",String(e.coords.latitude)),localStorage.setItem("user_lng",String(e.coords.longitude)),eX(!1)},e=>{if(1===e.code){let e=document.getElementById("location-denied-msg");e&&(e.style.display="block")}else eX(!1)},{enableHighAccuracy:!0,timeout:1e4})},className:"flex-1 bg-gradient-to-r from-teal-500 to-teal-600 text-white py-2 px-4 rounded-xl text-xs font-bold shadow-lg shadow-teal-500/20 flex items-center justify-center gap-1.5",children:[(0,s.jsx)("span",{children:"\uD83D\uDCCD"})," Compartir ubicaci\xf3n"]}),(0,s.jsx)("button",{onClick:()=>eX(!1),className:"px-3 py-2 text-slate-500 text-xs font-semibold hover:text-slate-300 transition",children:"Ahora no"}),(0,s.jsxs)("div",{id:"location-denied-msg",style:{display:"none"},className:"mt-2 p-2 bg-amber-500/10 border border-amber-500/30 rounded-xl",children:[(0,s.jsx)("p",{className:"text-amber-400 text-xs font-bold",children:"\uD83D\uDCF5 Permiso denegado"}),(0,s.jsxs)("p",{className:"text-slate-400 text-xs mt-0.5",children:["Ve a ",(0,s.jsx)("strong",{className:"text-white",children:"Ajustes → Apps → JobsHour → Permisos → Ubicaci\xf3n → Permitir"})]})]})]})]}),(0,s.jsx)("button",{onClick:()=>eX(!1),className:"text-slate-600 hover:text-slate-400",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-slate-950/60 backdrop-blur-sm z-[200] transition-opacity",onClick:()=>q(!1)}),(0,s.jsxs)("div",{className:"fixed left-0 top-0 h-full w-80 bg-slate-900 z-[201] shadow-2xl overflow-y-auto animate-slide-in-left border-r border-slate-800",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-md border-b border-slate-800 px-5 py-3 z-10 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-baseline font-black tracking-tighter text-lg",children:[(0,s.jsx)("span",{className:"text-white",children:"J"}),(0,s.jsxs)("div",{className:"relative mx-[1px] inline-flex h-[14px] w-[14px] -translate-y-[2px] align-baseline items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 rounded-full border-[1.5px] border-teal-400"}),(0,s.jsx)("div",{className:"absolute h-1/2 w-[1.5px] origin-bottom rounded-full bg-gradient-to-t from-teal-400 to-amber-300",style:{bottom:"50%",animation:"spin 3s linear infinite"}}),(0,s.jsx)("div",{className:"z-10 h-[3px] w-[3px] rounded-full bg-amber-400"})]}),(0,s.jsx)("span",{className:"text-white",children:"bs"}),(0,s.jsx)("span",{className:"text-teal-400 ml-0.5",children:"H"}),(0,s.jsxs)("div",{className:"relative mx-[1px] inline-flex h-[14px] w-[14px] -translate-y-[2px] align-baseline items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 rounded-full border-[1.5px] border-teal-400"}),(0,s.jsx)("div",{className:"absolute h-1/2 w-[1.5px] origin-bottom rounded-full bg-gradient-to-t from-teal-400 to-amber-300",style:{bottom:"50%",animation:"spin 3s linear infinite",animationDelay:"0.5s"}}),(0,s.jsx)("div",{className:"z-10 h-[3px] w-[3px] rounded-full bg-amber-400"})]}),(0,s.jsx)("span",{className:"bg-gradient-to-br from-teal-300 to-teal-500 bg-clip-text text-transparent",children:"urs"})]}),(0,s.jsx)("button",{onClick:()=>q(!1),className:"w-8 h-8 flex items-center justify-center text-slate-500 hover:text-slate-300 transition rounded-lg hover:bg-slate-800",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"p-0",children:eg?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"bg-gradient-to-br from-slate-800 via-slate-800 to-slate-900 px-5 py-5 border-b border-slate-700/50",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative",children:[eg.avatarUrl?(0,s.jsx)("img",{src:eg.avatarUrl,className:"w-14 h-14 rounded-full object-cover border-2 border-teal-400/50 shadow-[0_0_15px_rgba(45,212,191,0.2)]",alt:eg.firstName}):(0,s.jsx)("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-teal-400 to-teal-600 flex items-center justify-center border-2 border-teal-400/50 shadow-[0_0_15px_rgba(45,212,191,0.2)]",children:(0,s.jsx)("span",{className:"text-white text-xl font-black",children:eg.firstName.charAt(0)})}),(0,s.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 border-2 border-slate-800 rounded-full ".concat("active"===e$?"bg-teal-400":"intermediate"===e$?"bg-sky-400":"bg-slate-500")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-base font-black text-white",children:eg.name}),(0,s.jsx)("p",{className:"text-xs font-semibold text-amber-400/80",children:"active"===e$?"Disp. Inmediata":"intermediate"===e$?"Disp. Flexible":"Inactivo"})]})]})}),(0,s.jsxs)("div",{className:"px-4 py-3 space-y-0.5",children:[(0,s.jsx)("p",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest px-3 mb-2",children:"Principal"}),(0,s.jsxs)("button",{onClick:()=>{ey("profile"),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-teal-500/15 rounded-lg flex items-center justify-center group-hover:bg-teal-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),(0,s.jsx)("span",{className:"text-slate-300 text-sm font-semibold group-hover:text-white transition",children:"Mi Perfil"})]}),(0,s.jsxs)("button",{onClick:()=>{ey("jobs"),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-teal-500/15 rounded-lg flex items-center justify-center group-hover:bg-teal-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,s.jsx)("span",{className:"text-slate-300 text-sm font-semibold group-hover:text-white transition",children:"Mis Trabajos"})]}),(0,s.jsxs)("button",{onClick:()=>{let e=ti();if(!e.canInteract){"login"===e.reason?ev(!0):ew(!0);return}eB(!0),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-amber-500/15 rounded-lg flex items-center justify-center group-hover:bg-amber-500/25 transition",children:(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDCB0"})}),(0,s.jsx)("span",{className:"text-slate-300 text-sm font-semibold group-hover:text-white transition",children:"Publicar Demanda"})]}),(0,s.jsxs)("button",{onClick:()=>{eT(!0),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-teal-500/15 rounded-lg flex items-center justify-center group-hover:bg-teal-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),(0,s.jsx)("span",{className:"text-slate-300 text-sm font-semibold group-hover:text-white transition",children:"Mis Categor\xedas"})]})]}),(0,s.jsx)("div",{className:"h-px bg-slate-800 mx-5"}),(0,s.jsxs)("div",{className:"px-4 py-3 space-y-0.5",children:[(0,s.jsx)("p",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest px-3 mb-2",children:"Social"}),(0,s.jsxs)("button",{onClick:()=>{eD(!0),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-slate-700 rounded-lg flex items-center justify-center group-hover:bg-slate-600 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-slate-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})})}),(0,s.jsx)("span",{className:"text-slate-400 text-sm font-semibold group-hover:text-slate-200 transition",children:"Mis Amigos"})]}),(0,s.jsxs)("button",{onClick:()=>{eL(!0),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-slate-700 rounded-lg flex items-center justify-center group-hover:bg-slate-600 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),(0,s.jsx)("span",{className:"text-slate-400 text-sm font-semibold group-hover:text-slate-200 transition",children:"Mi Tarjeta"})]}),(0,s.jsxs)("button",{onClick:async()=>{let{setupNotifications:e}=await Promise.resolve().then(a.bind(a,6410)),t=localStorage.getItem("auth_token");t?(await e(t),alert("Notificaciones activadas correctamente")):alert("Debes iniciar sesi\xf3n primero"),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-amber-500/15 rounded-lg flex items-center justify-center group-hover:bg-amber-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-amber-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})})}),(0,s.jsx)("span",{className:"text-slate-400 text-sm font-semibold group-hover:text-slate-200 transition",children:"Notificaciones"})]})]}),(0,s.jsx)("div",{className:"h-px bg-slate-800 mx-5"}),(0,s.jsxs)("div",{className:"px-4 py-3 space-y-0.5",children:[(0,s.jsxs)("button",{onClick:()=>{let e="https://jobshour.dondemorales.cl",t="\xa1Encuentra servicios cerca de ti en JobsHours! \uD83D\uDD27⚡";navigator.share?navigator.share({title:"JobsHours",text:t,url:e}):window.open("https://wa.me/?text=".concat(encodeURIComponent(t+" "+e)),"_blank"),q(!1)},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-slate-800 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-teal-500/15 rounded-lg flex items-center justify-center group-hover:bg-teal-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),(0,s.jsx)("span",{className:"text-slate-400 text-sm font-semibold group-hover:text-slate-200 transition",children:"Compartir App"})]}),(0,s.jsxs)("button",{onClick:()=>{localStorage.removeItem("auth_token"),eb(null),eZ("guest"),alert("Sesi\xf3n cerrada")},className:"w-full flex items-center gap-3.5 px-3 py-2.5 hover:bg-red-500/10 rounded-xl transition group",children:[(0,s.jsx)("div",{className:"w-9 h-9 bg-red-500/15 rounded-lg flex items-center justify-center group-hover:bg-red-500/25 transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),(0,s.jsx)("span",{className:"text-red-400 text-sm font-semibold group-hover:text-red-300 transition",children:"Cerrar sesi\xf3n"})]})]}),(0,s.jsxs)("div",{className:"mx-5 mb-4 bg-teal-500/5 border border-teal-500/20 rounded-xl p-3 flex items-center gap-2.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4 text-teal-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,s.jsx)("p",{className:"text-[10px] text-teal-500/80 font-semibold",children:"Conexi\xf3n segura \xb7 SSL activo"})]})]}):(0,s.jsxs)("div",{className:"px-5 py-6 space-y-3",children:[(0,s.jsx)("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4",children:"Iniciar sesi\xf3n"}),(0,s.jsxs)("button",{onClick:async e=>{e.preventDefault();let{openExternalBrowser:t}=await a.e(16).then(a.bind(a,2016)),s=(await a.e(689).then(a.bind(a,6689))).Capacitor.isNativePlatform();await t(s?"https://jobshour.dondemorales.cl/api/auth/google?mobile=true":"https://jobshour.dondemorales.cl/api/auth/google")},className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 hover:border-slate-600 text-sm text-slate-300 font-semibold transition",children:[(0,s.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,s.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,s.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,s.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,s.jsx)("span",{children:"Continuar con Google"})]})]})}),(0,s.jsx)("div",{className:"sticky bottom-0 bg-slate-900 border-t border-slate-800 px-5 py-3",children:(0,s.jsx)("p",{className:"text-[10px] text-slate-600 font-semibold",children:"jobshour.dondemorales.cl"})})]})]}),U&&g&&(0,s.jsx)(y,{expert:{id:g.id,name:g.name,avatar:g.avatar,hourly_rate:g.hourly_rate,category:g.category?{name:g.category.name,color:g.category.color,icon:g.category.icon}:null,pos:g.pos,active_route:g.active_route||null},currentUser:eg,onClose:()=>O(!1),onSent:e=>{O(!1),J(e),Z(!0),e5("Solicitud enviada exitosamente","success"),Q({})}}),$&&G&&(0,s.jsx)(N,{requestId:G,currentUserId:0,onClose:()=>Z(!1),requestDescription:Y.description,otherPersonName:Y.name,otherPersonAvatar:Y.avatar}),e_&&eg&&(0,s.jsx)(S,{user:eg,onClose:()=>eD(!1)}),eS&&eg&&(0,s.jsx)(L,{user:eg,onClose:()=>eL(!1)}),eI&&g&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[(0,s.jsx)("h2",{className:"text-xl font-black text-gray-900",children:"Perfil del Trabajador"}),(0,s.jsx)("button",{onClick:()=>{eM(!1),ez(null)},className:"w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center justify-center transition",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,s.jsx)("img",{src:g.avatar||"https://i.pravatar.cc/100?u=".concat(g.id),alt:g.name,className:"w-20 h-20 rounded-full object-cover border-4 border-gray-200"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-2xl font-black text-gray-900",children:g.name}),g.nickname&&(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["@",g.nickname]}),g.is_verified&&(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 mt-1 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-bold",children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Verificado"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[void 0!==g.fresh_score&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Fresh Score"}),(0,s.jsx)("p",{className:"text-2xl font-black text-gray-900",children:g.fresh_score})]}),g.hourly_rate&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Tarifa por Hora"}),(0,s.jsxs)("p",{className:"text-2xl font-black text-blue-600",children:[F(g.hourly_rate),"/hr"]})]}),void 0!==g.rating_count&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Calificaciones"}),(0,s.jsx)("p",{className:"text-2xl font-black text-gray-900",children:g.rating_count})]}),void 0!==g.total_jobs&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Trabajos Completados"}),(0,s.jsx)("p",{className:"text-2xl font-black text-gray-900",children:g.total_jobs})]})]}),g.category&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Categor\xeda"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:g.category.icon||"\uD83D\uDCCC"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:g.category.name})]})]}),g.microcopy&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Descripci\xf3n"}),(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed",children:g.microcopy})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Estado"}),(0,s.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ".concat("active"===g.status?"bg-green-100 text-green-800":"intermediate"===g.status?"bg-sky-100 text-sky-800":"demand"===g.status?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:"active"===g.status?"Disponible":"intermediate"===g.status?"Disp. Flexible":"demand"===g.status?"Demanda activa":"No disponible"})]}),g.showcase_video&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Video de Presentaci\xf3n"}),(0,s.jsx)("div",{className:"bg-gray-100 rounded-xl p-4 text-center",children:(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Video disponible"})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"Rese\xf1as"}),(0,s.jsx)(T,{workerId:g.id,showAverage:!0,canRespond:!1})]})]})]})}),eF&&eR&&eH&&(0,s.jsx)(A,{isOpen:eF,onClose:()=>{eV(!1),eW(null),eq(null)},serviceRequestId:eR,workerName:eH.name,workerAvatar:eH.avatar,onRated:()=>{if(eR&&localStorage.setItem("rated_".concat(eR),"true"),eV(!1),eW(null),eq(null),eg){let e=localStorage.getItem("auth_token")||localStorage.getItem("token");e&&fetch("".concat(V,"/api/v1/requests/mine"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json()).then(e=>{})}}}),eU&&(0,s.jsx)("div",{className:"fixed inset-0 z-[300] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("span",{className:"text-3xl",children:"⚙️"})}),(0,s.jsx)("h3",{className:"text-xl font-black text-gray-900 mb-2",children:"Configura tu perfil"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Necesitas seleccionar al menos una habilidad para poder activar el modo trabajo y aparecer en el mapa."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{onClick:()=>{eO(!1),ey("profile"),q(!0)},className:"w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-black text-base shadow-lg hover:from-yellow-500 hover:to-orange-600 transition",children:"Ir a Mi Perfil →"}),(0,s.jsx)("button",{onClick:()=>eO(!1),className:"w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold text-sm hover:bg-gray-200 transition",children:"Cancelar"})]})]})}),(0,s.jsx)(I,{user:eg,onActivate:()=>{tm()},onShowLogin:()=>ev(!0),onRequireCategory:()=>{eg&&(ey("profile"),q(!0))},onStatusChange:()=>{tm();let e=localStorage.getItem("auth_token");e&&tc(e)}}),"map"===eQ&&(0,s.jsx)("div",{className:"fixed bottom-[68px] left-4 z-[91]",children:(0,s.jsx)(w,{status:e$,loading:e1,isLoggedIn:!!eg,onActivate:()=>{if(0===eG.length){eO(!0);return}tv("active")},onChangeTo:tv,onShowLogin:()=>ev(!0)})}),(0,s.jsx)(b,{active:eQ,onChange:tf,requestsBadge:K.length,demandsBadge:e.filter(e=>"demand"===e.pin_type).length,isWorker:"guest"!==e$&&"inactive"!==e$}),u&&(0,s.jsxs)("div",{className:"absolute inset-0 z-[150] bg-slate-950 flex flex-col items-center justify-center p-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h1",{className:"text-7xl font-black tracking-tight leading-none mb-5 flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"text-gray-100",children:"Jobs"}),(0,s.jsxs)("span",{className:"text-teal-400 flex items-center",children:[(0,s.jsx)("span",{children:"H"}),(0,s.jsxs)("span",{className:"relative inline-flex items-center justify-center w-16 h-16 mx-1",children:[(0,s.jsx)("span",{className:"absolute inset-0 rounded-full border-4 border-teal-400 shadow-[0_0_20px_rgba(45,212,191,0.35)]"}),(0,s.jsx)("span",{className:"clock-hand-long",style:{position:"absolute",bottom:"50%",left:"50%",width:"3px",height:"44%",background:"linear-gradient(to top, #5eead4, #fbbf24)",borderRadius:"2px",transformOrigin:"bottom center"}}),(0,s.jsx)("span",{className:"clock-hand-short",style:{position:"absolute",bottom:"50%",left:"50%",width:"3px",height:"30%",background:"#f1f5f9",borderRadius:"2px",transformOrigin:"bottom center"}}),(0,s.jsx)("span",{className:"w-3 h-3 rounded-full bg-amber-400 z-10 shadow-md",style:{position:"relative"}})]}),(0,s.jsx)("span",{children:"urs"})]})]}),(0,s.jsx)("p",{className:"text-xl font-medium text-amber-300",children:"Servicios ahora, cerca de ti"})]}),(0,s.jsxs)("div",{className:"mt-10 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-teal-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-teal-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),eU&&(0,s.jsx)("div",{className:"fixed inset-0 z-[300] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("span",{className:"text-3xl",children:"⚙️"})}),(0,s.jsx)("h3",{className:"text-xl font-black text-gray-900 mb-2",children:"Configura tu perfil"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Necesitas seleccionar al menos una habilidad para poder activar el modo trabajo y aparecer en el mapa."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{onClick:()=>{eO(!1),ey("profile"),q(!0)},className:"w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-black text-base shadow-lg hover:from-yellow-500 hover:to-orange-600 transition",children:"Ir a Mi Perfil →"}),(0,s.jsx)("button",{onClick:()=>eO(!1),className:"w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold text-sm hover:bg-gray-200 transition",children:"Cancelar"})]})]})}),ej&&eg&&(0,s.jsx)(_,{isOpen:ej,onClose:()=>{ew(!1)},onComplete:async()=>{ew(!1),(null==eg?void 0:eg.id)&&localStorage.setItem("onboarding_done_".concat(eg.id),"true");let e=localStorage.getItem("auth_token")||localStorage.getItem("token");e&&await tc(e)},userToken:eg.token,userName:eg.name,userAvatar:eg.avatarUrl}),(0,s.jsx)(x,{toasts:e3,onRemove:e4})]})}},6410:function(e,t,a){"use strict";let s;a.d(t,{Lu:function(){return p},setupNotifications:function(){return h}});var r=a(738),o=a(7012),l=a(257);let n={apiKey:"AIzaSyAUXgn2XXRfBjAHUF4kLkj_yF6Nq6WgaIM",authDomain:"jobshours.firebaseapp.com",projectId:"jobshours",storageBucket:"jobshours.firebasestorage.app",messagingSenderId:"323777995233",appId:"1:323777995233:web:5b3efcafc6b6c38240b2a0"},i=e=>{try{let t=e.trim().replace(/\s/g,"");if(!/^[A-Za-z0-9_-]+$/.test(t))throw Error("VAPID key contiene caracteres inv\xe1lidos");let a=t.length%4,s=0===a?"":"=".repeat(4-a),r=t+s;console.log("VAPID processing:"),console.log("- Original length:",e.length),console.log("- Clean length:",t.length),console.log("- Padding added:",s.length),console.log("- Final length:",r.length);let o=r.replace(/-/g,"+").replace(/_/g,"/"),l=atob(o),n=new Uint8Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);return n}catch(e){throw console.error("VAPID conversion error:",e.message||e),e}},c=e=>e.trim().replace(/\s/g,""),d=null,u=async()=>{if(!await (0,o.Gb)())return console.log("Firebase Messaging not supported"),null;try{return s=(0,r.ZF)(n),d=(0,o.KL)(s)}catch(e){if("app/duplicate-app"===e.code)return s=(0,r.Mq)(),d=(0,o.KL)(s);return console.error("Firebase init error:",e),null}},x=async()=>{try{if(!("Notification"in window))return console.log("Notifications not supported"),null;if(console.log("[FCM] origin:",window.location.origin),console.log("[FCM] isSecureContext:",window.isSecureContext),!window.isSecureContext)return console.error("[FCM] Not a secure context - notifications will be blocked"),alert("FCM diagn\xf3stico:\n"+"origin: ".concat(window.location.origin,"\n")+"isSecureContext: ".concat(window.isSecureContext,"\n")+"Notification.permission: ".concat(Notification.permission,"\n\n")+"Este navegador indica que la p\xe1gina NO es un contexto seguro (isSecureContext=false). Sin eso, las notificaciones push se bloquean. Revisa el candado/SSL y recarga."),null;let e=Notification.permission;if(console.log("[FCM] Current permission state:",e),"denied"===e)return console.error("[FCM] Permission denied - user must unblock manually"),alert("FCM diagn\xf3stico:\n"+"origin: ".concat(window.location.origin,"\n")+"isSecureContext: ".concat(window.isSecureContext,"\n")+"Notification.permission: ".concat(Notification.permission,"\n\n")+'Las notificaciones est\xe1n bloqueadas. Para activarlas:\n1. Click en el \xedcono \uD83D\uDD12 a la izquierda de la URL\n2. Click en "Configuraci\xf3n del sitio"\n3. Busca "Notificaciones" y c\xe1mbialo a "Permitir"\n\nLuego recarga la p\xe1gina.'),null;let t=await Notification.requestPermission();if(console.log("[FCM] Permission after request:",t),"denied"===t)return alert("FCM diagn\xf3stico:\n"+"origin: ".concat(window.location.origin,"\n")+"isSecureContext: ".concat(window.isSecureContext,"\n")+"Notification.permission: ".concat(Notification.permission,"\n\n")+"Permiso de notificaciones denegado. Para recibir push notifications, permite las notificaciones en la configuraci\xf3n del sitio (\uD83D\uDD12 → Configuraci\xf3n del sitio → Notificaciones)."),null;if("granted"!==t)return console.log("[FCM] Permission not granted:",t),null;let a=await u();if(!a)return null;let s=l.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY;if(!s){console.log("No VAPID key, trying without...");try{let e=await (0,o.LP)(a);return console.log("FCM Token (no VAPID):",e),e}catch(e){return console.error("Error without VAPID:",e),null}}s=c(s),console.log("VAPID Key raw:",s);try{console.log("Trying VAPID as string...");let e=await (0,o.LP)(a,{vapidKey:s});return console.log("FCM Token (string VAPID):",e),e}catch(e){console.log("String VAPID failed, trying Uint8Array...")}try{let e=i(s);console.log("VAPID Key as Uint8Array, length:",e.length);let t=await (0,o.LP)(a,{vapidKey:e});return console.log("FCM Token (Uint8Array VAPID):",t),t}catch(e){return console.error("Both VAPID methods failed:",e),null}}catch(e){return console.error("Error:",e),null}},m=async(e,t)=>{try{let a="".concat("https://jobshour.dondemorales.cl","/notifications/register-token");console.log("[FCM] Register URL:",a),console.log("[FCM] Token length:",e.length);let s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({fcm_token:e})});console.log("[FCM] Response status:",s.status);let r=await s.text();return console.log("[FCM] Response body:",r),s.ok}catch(e){return console.error("[FCM] Error registering token:",e),!1}},h=async e=>{console.log("[FCM] setupNotifications started");let t=await x();console.log("[FCM] Got token:",t?t.substring(0,20)+"...":"null"),t?(console.log("[FCM] Registering token with backend..."),console.log("[FCM] Token registration result:",await m(t,e)?"success":"failed"),console.log("[FCM] Notifications ready")):console.warn("[FCM] No token obtained")},p=()=>{d&&(0,o.ps)(d,e=>{if(console.log("Message received:",e),"granted"===Notification.permission){let{title:t,body:a}=e.notification||{};t&&new Notification(t,{body:a||"",icon:"/icon-192x192.png"})}})}}},function(e){e.O(0,[75,971,117,744],function(){return e(e.s=1692)}),_N_E=e.O()}]);