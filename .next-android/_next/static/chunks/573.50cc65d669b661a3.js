"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{8573:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var s=a(7437),r=a(2265),n=a(1837);let l={wrench:"\uD83D\uDD27",zap:"⚡",paintbrush:"\uD83C\uDFA8",sparkles:"✨",hammer:"\uD83D\uDD28",leaf:"\uD83C\uDF3F",key:"\uD83D\uDD11",building:"\uD83C\uDFD7️",scissors:"✂️","paw-print":"\uD83D\uDC3E",truck:"\uD83D\uDE9A","shopping-cart":"\uD83D\uDED2",car:"\uD83D\uDE97",baby:"\uD83D\uDC76","heart-handshake":"\uD83E\uDD1D",dog:"\uD83D\uDC15","graduation-cap":"\uD83C\uDF93",music:"\uD83C\uDFB5",hand:"\uD83D\uDC86",activity:"\uD83C\uDFC3",utensils:"\uD83C\uDF7D️","chef-hat":"\uD83D\uDC68‍\uD83C\uDF73",disc:"\uD83C\uDFA7",camera:"\uD83D\uDCF7",monitor:"\uD83D\uDCBB",wifi:"\uD83D\uDCF6",flame:"\uD83D\uDD25",rabbit:"\uD83D\uDC07",droplet:"\uD83D\uDCA7",droplets:"\uD83D\uDCA7","key-round":"\uD83D\uDD11","hard-hat":"\uD83D\uDC77",trees:"\uD83C\uDF33",home:"\uD83C\uDFE0",package:"\uD83D\uDCE6"};function i(e){return e&&l[e]||"\uD83D\uDCCB"}function o(e){let{categories:t,selectedId:a,onSelect:n,placeholder:l="Buscar categor\xeda...",multiple:o=!1,selectedIds:u=[],onSelectMultiple:c}=e,[d,m]=(0,r.useState)(""),[x,p]=(0,r.useState)(!1),h=(0,r.useRef)(null),g=(0,r.useRef)(null),b=t.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),D=t.find(e=>e.id===a);function f(e){o&&c?c(u.includes(e)?u.filter(t=>t!==e):[...u,e]):(n(e),p(!1),m(""))}return(0,r.useEffect)(()=>{function e(e){h.current&&!h.current.contains(e.target)&&p(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.jsxs)("div",{ref:h,className:"relative",children:[(0,s.jsxs)("div",{onClick:()=>{p(!x),setTimeout(()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.focus()},50)},className:"w-full px-3 py-2 border rounded-lg cursor-pointer flex items-center justify-between bg-white hover:border-gray-400 transition",children:[o?(0,s.jsx)("span",{className:"text-sm truncate",children:u.length>0?"".concat(u.length," categor\xeda").concat(u.length>1?"s":""," seleccionada").concat(u.length>1?"s":""):(0,s.jsx)("span",{className:"text-gray-400",children:l})}):(0,s.jsx)("span",{className:"text-sm truncate",children:D?(0,s.jsxs)("span",{children:[i(D.icon)," ",D.name]}):(0,s.jsx)("span",{className:"text-gray-400",children:l})}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition ".concat(x?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&u.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:u.map(e=>{let a=t.find(t=>t.id===e);return a?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs font-semibold px-2 py-1 rounded-full",style:{backgroundColor:(a.color||"#6b7280")+"20",color:a.color||"#6b7280"},children:[i(a.icon)," ",a.name,(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),f(e)},className:"ml-0.5 hover:opacity-70",children:"\xd7"})]},e):null})}),x&&(0,s.jsxs)("div",{className:"absolute z-50 mt-1 w-full bg-white border rounded-lg shadow-xl max-h-64 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-2 border-b sticky top-0 bg-white",children:(0,s.jsx)("input",{ref:g,type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"\uD83D\uDD0D Buscar...",className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-300",autoFocus:!0})}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-48",children:0===b.length?(0,s.jsx)("div",{className:"p-3 text-center text-gray-400 text-sm",children:"No se encontraron categor\xedas"}):b.map(e=>{let t=o?u.includes(e.id):e.id===a;return(0,s.jsxs)("button",{onClick:()=>f(e.id),className:"w-full flex items-center gap-2.5 px-3 py-2.5 text-left text-sm hover:bg-gray-50 transition ".concat(t?"bg-blue-50 font-bold":""),children:[(0,s.jsx)("span",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-base shrink-0",style:{backgroundColor:(e.color||"#6b7280")+"20"},children:i(e.icon)}),(0,s.jsx)("span",{className:"truncate",children:e.name}),t&&(0,s.jsx)("span",{className:"ml-auto text-blue-500 font-bold",children:"✓"})]},e.id)})})]})]})}function u(e){let{userLat:t,userLng:a,categories:l,onClose:i,onPublished:u}=e,[c,d]=(0,r.useState)("fixed_job"),[m,x]=(0,r.useState)("passenger"),[p,h]=(0,r.useState)(null),[g,b]=(0,r.useState)(""),[D,f]=(0,r.useState)(""),[j,y]=(0,r.useState)("medium"),[v,N]=(0,r.useState)(30),[w,C]=(0,r.useState)(""),[S,_]=(0,r.useState)(""),[k,E]=(0,r.useState)(t),[F,O]=(0,r.useState)(a),[I,L]=(0,r.useState)(null),[B,A]=(0,r.useState)(null),[P,z]=(0,r.useState)(""),[T,R]=(0,r.useState)(1),[q,J]=(0,r.useState)(""),[Q,U]=(0,r.useState)(""),[M,V]=(0,r.useState)(""),[W,$]=(0,r.useState)("medium"),[G,H]=(0,r.useState)(!1),[K,X]=(0,r.useState)(""),[Y,Z]=(0,r.useState)(1),[ee,et]=(0,r.useState)("once"),[ea,es]=(0,r.useState)([]),[er,en]=(0,r.useState)(null),[el,ei]=(0,r.useState)(null),[eo,eu]=(0,r.useState)(!1),[ec,ed]=(0,r.useState)("");(0,r.useEffect)(()=>{"fixed_job"===c&&h(null)},[c]),(0,r.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{E(e.coords.latitude),O(e.coords.longitude)},()=>{})},[]);let em=async()=>{if(ed(""),!p){ed("Selecciona una categor\xeda");return}if(!g.trim()){ed("Ingresa una descripci\xf3n");return}if("ride_share"===c){if(!w.trim()||!S.trim()){ed("Ingresa origen y destino");return}if(!P){ed("Selecciona hora de salida");return}if(new Date(P)<=new Date){ed("La hora de salida debe ser en el futuro");return}}if("express_errand"===c&&!Q.trim()){ed("Ingresa el nombre del negocio");return}eu(!0);try{let e;let t=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!t){ed("Debes iniciar sesi\xf3n"),eu(!1);return}let a={category_id:p,description:g.trim(),lat:k,lng:F,offered_price:D?parseFloat(D):null,urgency:j,ttl_minutes:v,type:c,category_type:"ride_share"===c?"travel":"express_errand"===c?"errand":"fixed",workers_needed:Y,recurrence:ee,...K?{scheduled_at:new Date(K).toISOString()}:{},..."custom"===ee&&ea.length>0?{recurrence_days:ea}:{}};if("ride_share"===c?(a.travel_role=m,a.pickup_address=w.trim(),a.delivery_address=S.trim(),a.pickup_lat=k,a.pickup_lng=F,a.delivery_lat=I,a.delivery_lng=B,a.departure_time=new Date(P).toISOString(),a.seats=T,a.destination_name=q.trim()||S.trim(),a.payload={travel_role:m,seats:T,departure_time:new Date(P).toISOString(),destination_name:q.trim()||S.trim(),origin_address:w.trim(),destination_address:S.trim()}):"express_errand"===c&&(a.store_name=Q.trim(),a.items_count=M?parseInt(M):null,a.load_type=W,a.requires_vehicle=G,a.payload={store_name:Q.trim(),items_count:M?parseInt(M):null,load_type:W,requires_vehicle:G}),er){let s=new FormData;Object.entries(a).forEach(e=>{let[t,a]=e;null!=a&&("object"==typeof a&&"payload"===t?s.append(t,JSON.stringify(a)):s.append(t,String(a)))}),s.append("image",er),e={method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:s}}else e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(a)};let s=await (0,n.S)("/api/v1/demand/publish",e),r=await s.json();s.ok&&"success"===r.status?(ed(""),setTimeout(()=>{u(),i()},300)):ed(r.message||r.errors?JSON.stringify(r.errors):"Error al publicar demanda")}catch(e){ed(e.message||"Error de conexi\xf3n")}finally{eu(!1)}},[ex,ep]=(0,r.useState)(!1);return(0,s.jsx)("div",{className:"fixed inset-0 z-[400] bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"\xbfQu\xe9 necesitas?"}),(0,s.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[ec&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded text-sm",children:ec}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["Categor\xeda ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(o,{categories:l,selectedId:p,onSelect:e=>h(e),placeholder:"\xbfQu\xe9 tipo de servicio?"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-semibold mb-2",children:["\xbfQu\xe9 necesitas? ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("textarea",{value:g,onChange:e=>b(e.target.value),placeholder:"Describe brevemente lo que necesitas...",className:"w-full h-24 px-3 py-2 border rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-amber-400",maxLength:500})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Precio ofrecido (CLP)"}),(0,s.jsx)("input",{type:"number",value:D,onChange:e=>f(e.target.value),placeholder:"Ej: 5000 (opcional)",className:"w-full px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-amber-400"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>ep(!ex),className:"w-full flex items-center justify-between px-3 py-2 rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold",children:[(0,s.jsx)("span",{children:"⚙️ Opciones avanzadas"}),(0,s.jsx)("span",{children:ex?"▲":"▼"})]}),ex&&(0,s.jsxs)("div",{className:"space-y-4 border border-slate-200 rounded-xl p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Tipo de servicio"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[["fixed_job","\uD83D\uDD27 Trabajo"],["ride_share","\uD83D\uDE97 Viaje"],["express_errand","\uD83D\uDCE6 Compra"]].map(e=>{let[t,a]=e;return(0,s.jsx)("button",{onClick:()=>d(t),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(c===t?"bg-amber-100 text-amber-700 ring-2 ring-amber-400":"bg-gray-100 text-gray-500"),children:a},t)})})]}),"ride_share"===c&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("input",{type:"text",value:w,onChange:e=>C(e.target.value),placeholder:"Origen",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsx)("input",{type:"text",value:S,onChange:e=>{_(e.target.value),J(e.target.value)},placeholder:"Destino",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsx)("input",{type:"datetime-local",value:P,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm"})]}),"express_errand"===c&&(0,s.jsx)("input",{type:"text",value:Q,onChange:e=>U(e.target.value),placeholder:"Nombre del negocio",className:"w-full px-3 py-2 border rounded-lg text-sm"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Urgencia"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["low","medium","high"].map(e=>(0,s.jsx)("button",{onClick:()=>y(e),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(j===e?"bg-red-100 text-red-700 ring-2 ring-red-400":"bg-gray-100 text-gray-500"),children:"low"===e?"Baja":"medium"===e?"Media":"Alta"},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-semibold mb-2 text-slate-500",children:"Foto (opcional)"}),el?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:el,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border"}),(0,s.jsx)("button",{onClick:()=>{en(null),ei(null)},className:"absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs font-bold",children:"\xd7"})]}):(0,s.jsxs)("label",{className:"flex items-center justify-center gap-2 w-full py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer text-sm text-gray-500",children:[(0,s.jsx)("span",{children:"\uD83D\uDCF7 Agregar foto"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(en(a),ei(URL.createObjectURL(a)))}})]})]})]}),(0,s.jsx)("button",{onClick:em,disabled:eo||!p||!g.trim(),className:"w-full bg-amber-500 text-white py-3 rounded-xl font-bold text-sm hover:bg-amber-600 transition disabled:opacity-50 disabled:cursor-not-allowed",children:eo?"Publicando...":"✨ Publicar"})]})]})})}},1837:function(e,t,a){a.d(t,{S:function(){return r}});let s="https://jobshour.dondemorales.cl".replace(/\/api$/,"");async function r(e,t){return fetch(s?"".concat(s).concat(e):e,t)}}}]);