"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{3268:function(e,t,a){a.r(t),a.d(t,{default:function(){return l}});var r=a(7437),s=a(2265);function l(e){var t;let{expert:a,currentUser:l,onClose:n,onSent:i}=e;if(!a||!a.id)return console.error("❌ ServiceRequestModal: expert no v\xe1lido",a),(0,r.jsx)("div",{className:"fixed inset-0 z-[300] flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-2xl",children:[(0,r.jsx)("p",{className:"text-red-500",children:"Error: Datos del trabajador no v\xe1lidos"}),(0,r.jsx)("button",{onClick:n,className:"mt-4 bg-gray-900 text-white px-4 py-2 rounded-lg",children:"Cerrar"})]})});let[o,d]=(0,s.useState)(""),[c,x]=(0,s.useState)("normal"),[u,m]=(0,s.useState)(!1),[g,b]=(0,s.useState)(""),[p,h]=(0,s.useState)("fixed_job"),[v,f]=(0,s.useState)(null),[j,y]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),[w,_]=(0,s.useState)(""),[C,D]=(0,s.useState)(""),[S,E]=(0,s.useState)("medium"),[L,z]=(0,s.useState)(!1),[I,M]=(0,s.useState)(""),[q,T]=(0,s.useState)(""),[O,A]=(0,s.useState)(""),[B,R]=(0,s.useState)(1),P=(null===(t=a.category)||void 0===t?void 0:t.icon)==="package",U=a.active_route&&a.active_route.destination;(0,s.useEffect)(()=>{if(U&&a.active_route){var e,t;if(h("ride_share"),T((null===(e=a.active_route.destination)||void 0===e?void 0:e.address)||""),M((null===(t=a.active_route.origin)||void 0===t?void 0:t.address)||"Mi ubicaci\xf3n"),a.active_route.departure_time){let e=new Date(a.active_route.departure_time);A(new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,16))}R(a.active_route.available_seats||1)}else P&&h("express_errand")},[U,P,a.active_route]);let V=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!V||!l)return(0,r.jsxs)("div",{className:"fixed inset-0 z-[300] flex items-end justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:n}),(0,r.jsx)("div",{className:"relative w-full max-w-md bg-white rounded-t-2xl shadow-2xl p-5 pb-8 animate-slide-up",children:(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsx)("h3",{className:"text-lg font-black text-gray-900 mb-2",children:"Sesi\xf3n expirada"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Debes iniciar sesi\xf3n para solicitar servicios"}),(0,r.jsx)("button",{onClick:n,className:"w-full bg-gray-900 text-white py-3 rounded-xl font-bold text-sm hover:bg-gray-800 transition",children:"Cerrar"})]})})]});if(!(l.avatar||l.avatarUrl)||!l.name||"Usuario"===l.name)return(0,r.jsxs)("div",{className:"fixed inset-0 z-[300] flex items-end justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:n}),(0,r.jsx)("div",{className:"relative w-full max-w-md bg-white rounded-t-2xl shadow-2xl p-5 pb-8 animate-slide-up",children:(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,r.jsx)("h3",{className:"text-lg font-black text-gray-900 mb-2",children:"Completa tu perfil"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Necesitas agregar tu foto y nombre para solicitar servicios"}),(0,r.jsx)("button",{onClick:n,className:"w-full bg-gray-900 text-white py-3 rounded-xl font-bold text-sm hover:bg-gray-800 transition",children:"Cerrar"})]})})]});let W=async()=>{if(!V){b("Debes iniciar sesi\xf3n para solicitar servicios");return}m(!0),b("");try{let h={worker_id:a.id,type:p,category_type:"ride_share"===p?"travel":"express_errand"===p?"errand":"fixed",description:o.trim()||null,urgency:c,offered_price:a.hourly_rate};if("ride_share"===p){var e,t,r,s,l,n,d,x,u,g;if(!I.trim()||!q.trim()){b("Ingresa origen y destino"),m(!1);return}if(!O){b("Selecciona hora de salida"),m(!1);return}if(new Date(O)<=new Date){b("La hora de salida debe ser en el futuro"),m(!1);return}h.pickup_address=I.trim(),h.delivery_address=q.trim(),h.pickup_lat=(null===(t=a.active_route)||void 0===t?void 0:null===(e=t.origin)||void 0===e?void 0:e.lat)||(null===(r=a.pos)||void 0===r?void 0:r.lat)||null,h.pickup_lng=(null===(l=a.active_route)||void 0===l?void 0:null===(s=l.origin)||void 0===s?void 0:s.lng)||(null===(n=a.pos)||void 0===n?void 0:n.lng)||null,h.delivery_lat=(null===(x=a.active_route)||void 0===x?void 0:null===(d=x.destination)||void 0===d?void 0:d.lat)||null,h.delivery_lng=(null===(g=a.active_route)||void 0===g?void 0:null===(u=g.destination)||void 0===u?void 0:u.lng)||null,h.departure_time=new Date(O).toISOString(),h.seats=B,h.destination_name=q.trim(),h.payload={seats:B,departure_time:new Date(O).toISOString(),destination_name:q.trim()}}"express_errand"===p&&(h.carga_tipo=v,h.carga_peso=j?parseFloat(j):null,h.delivery_address=N.trim()||null,h.store_name=w.trim()||null,h.items_count=C?parseInt(C):null,h.load_type=S,h.requires_vehicle=L,a.pos&&(h.delivery_lat=a.pos.lat,h.delivery_lng=a.pos.lng),h.payload={store_name:w.trim()||null,items_count:C?parseInt(C):null,load_type:S,requires_vehicle:L});let f=await fetch("/api/v1/requests",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(V)},body:JSON.stringify(h)}),y=await f.json();if(f.ok)i(y.data.id);else{let e=y.message||(y.errors?Object.values(y.errors).flat().join(", "):"Error al enviar solicitud");b(e),setTimeout(()=>{let e=document.querySelector(".text-red-500");null==e||e.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}}catch(e){console.error("Error completo:",e),console.error("Error message:",null==e?void 0:e.message),console.error("Error stack:",null==e?void 0:e.stack),b((null==e?void 0:e.message)||"Error de conexi\xf3n - revisa consola (F12)")}m(!1)};return(0,r.jsxs)("div",{className:"fixed inset-0 z-[300] flex items-end justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:n}),(0,r.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-t-2xl shadow-2xl p-5 pb-8 animate-slide-up",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-black text-gray-900",children:"Solicitar servicio"}),(0,r.jsx)("button",{onClick:n,className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl mb-4",children:[(0,r.jsx)("img",{src:a.avatar||"https://i.pravatar.cc/80?u=".concat(a.id),alt:a.name,className:"w-11 h-11 rounded-lg object-cover"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-bold text-sm text-gray-900",children:a.name}),a.category&&(0,r.jsx)("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full text-white",style:{backgroundColor:a.category.color},children:a.category.name}),U&&(0,r.jsx)("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full bg-green-100 text-green-700 mt-1 inline-block",children:"\uD83D\uDE97 Viaje disponible"})]}),(0,r.jsxs)("span",{className:"font-bold text-blue-600 text-sm",children:["$",a.hourly_rate.toLocaleString("es-CL"),"/hr"]})]}),!U&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-2",children:"Tipo de Servicio"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,r.jsx)("button",{onClick:()=>h("fixed_job"),className:"py-2 px-2 rounded-lg text-xs font-semibold transition ".concat("fixed_job"===p?"bg-blue-100 text-blue-700 ring-2 ring-blue-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDD27 Trabajo"}),(0,r.jsx)("button",{onClick:()=>h("ride_share"),className:"py-2 px-2 rounded-lg text-xs font-semibold transition ".concat("ride_share"===p?"bg-green-100 text-green-700 ring-2 ring-green-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDE97 Viaje"}),(0,r.jsx)("button",{onClick:()=>h("express_errand"),className:"py-2 px-2 rounded-lg text-xs font-semibold transition ".concat("express_errand"===p?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDCE6 Compra"})]})]}),"ride_share"===p&&(0,r.jsxs)("div",{className:"space-y-3 mb-4 bg-green-50 p-3 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-xs font-bold text-green-800 mb-2",children:"Detalles del Viaje"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Origen"}),(0,r.jsx)("input",{type:"text",value:I,onChange:e=>M(e.target.value),placeholder:"Ej: Renaico, Calle Principal 123",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Destino"}),(0,r.jsx)("input",{type:"text",value:q,onChange:e=>T(e.target.value),placeholder:"Ej: Angol, Hospital",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Hora de Salida"}),(0,r.jsx)("input",{type:"datetime-local",value:O,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Asientos Necesarios"}),(0,r.jsx)("input",{type:"number",min:"1",max:"8",value:B,onChange:e=>R(parseInt(e.target.value)||1),className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]})]}),"express_errand"===p&&(0,r.jsxs)("div",{className:"space-y-3 mb-4 bg-orange-50 p-3 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-xs font-bold text-orange-800 mb-2",children:"Detalles de la Compra"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Nombre del Negocio"}),(0,r.jsx)("input",{type:"text",value:w,onChange:e=>_(e.target.value),placeholder:"Ej: Supermercado Angol",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Cantidad de Art\xedculos"}),(0,r.jsx)("input",{type:"number",min:"1",value:C,onChange:e=>D(e.target.value),placeholder:"Ej: 15",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Tipo de Carga"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["light","medium","heavy"].map(e=>(0,r.jsx)("button",{onClick:()=>E(e),className:"py-2 rounded-lg text-xs font-semibold transition ".concat(S===e?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-gray-100 text-gray-500"),children:"light"===e?"Ligera":"medium"===e?"Media":"Pesada"},e))})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:L,onChange:e=>z(e.target.checked),className:"w-4 h-4"}),(0,r.jsx)("label",{className:"text-xs",children:"Requiere veh\xedculo"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium mb-1 block",children:"Direcci\xf3n de Entrega"}),(0,r.jsx)("input",{type:"text",value:N,onChange:e=>k(e.target.value),placeholder:"Calle, n\xfamero, comuna",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm"})]})]}),P&&"express_errand"===p&&!w&&(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"Tipo de carga"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,r.jsx)("button",{onClick:()=>f("sobre"),className:"py-2 rounded-lg text-xs font-semibold transition ".concat("sobre"===v?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDCC4 Sobre"}),(0,r.jsx)("button",{onClick:()=>f("paquete"),className:"py-2 rounded-lg text-xs font-semibold transition ".concat("paquete"===v?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDCE6 Paquete"}),(0,r.jsx)("button",{onClick:()=>f("bulto"),className:"py-2 rounded-lg text-xs font-semibold transition ".concat("bulto"===v?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-gray-100 text-gray-500"),children:"\uD83D\uDECD️ Bulto"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"Peso aproximado (kg)"}),(0,r.jsx)("input",{type:"number",value:j,onChange:e=>y(e.target.value),placeholder:"Ej: 2.5",step:"0.1",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-700 mb-1 block",children:"Direcci\xf3n de entrega"}),(0,r.jsx)("input",{type:"text",value:N,onChange:e=>k(e.target.value),placeholder:"Calle, n\xfamero, comuna",className:"w-full px-3 py-2 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),N&&(0,r.jsxs)("button",{onClick:()=>{let e=encodeURIComponent(N);window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(e),"_blank")},className:"w-full bg-green-500 text-white py-2 rounded-xl font-bold text-sm hover:bg-green-600 transition flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),"Abrir en Google Maps"]})]}),(0,r.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),placeholder:"ride_share"===p?"Detalles adicionales del viaje (opcional)...":"express_errand"===p?"Lista de productos o detalles de la compra...":"Describe brevemente lo que necesitas...",className:"w-full h-20 px-3 py-2 border border-gray-200 rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder:text-gray-400",maxLength:500}),(0,r.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,r.jsx)("button",{onClick:()=>x("normal"),className:"flex-1 py-2 rounded-lg text-xs font-semibold transition ".concat("normal"===c?"bg-blue-100 text-blue-700 ring-2 ring-blue-500":"bg-gray-100 text-gray-500"),children:"Normal"}),(0,r.jsx)("button",{onClick:()=>x("urgent"),className:"flex-1 py-2 rounded-lg text-xs font-semibold transition ".concat("urgent"===c?"bg-red-100 text-red-700 ring-2 ring-red-500":"bg-gray-100 text-gray-500"),children:"Urgente"})]}),g&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-2",children:g}),(0,r.jsx)("button",{onClick:W,disabled:u,className:"w-full mt-4 bg-gray-900 text-white py-3 rounded-xl font-bold text-sm hover:bg-gray-800 transition disabled:opacity-50",children:u?(0,r.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Enviando..."]}):"Enviar solicitud"}),(0,r.jsx)("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:"El trabajador tiene 5 minutos para responder"})]})]})}}}]);