"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{9820:function(t,e,a){a.r(e),a.d(e,{default:function(){return o}});var n=a(7437),i=a(2265);function o(t){let{user:e,onActivate:a,onShowLogin:o,onRequireCategory:r,onStatusChange:c}=t,[s,l]=(0,i.useState)("guest"),[u,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{e?h():l("guest")},[e]);let h=async()=>{try{let t=localStorage.getItem("auth_token")||localStorage.getItem("token"),e=await fetch("/api/auth/me",{headers:t?{Authorization:"Bearer ".concat(t)}:{}});(await e.json()).worker,l("inactive")}catch(t){l("inactive")}},d=async t=>"inactive"===t?"active":"active"===t?"listening":"inactive",v=async()=>{if("guest"===s){localStorage.setItem("worker_intent","activate"),o();return}if("inactive"===s){a();return}let t=await d(s);if(confirm({listening:"\xbfCambiar a Modo Ahorro? Seguir\xe1s visible a 5km.",inactive:"\xbfDesconectarte del mapa?"}[t])){g(!0);try{let e=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!navigator.geolocation)return;navigator.geolocation.getCurrentPosition(async a=>{let n=await fetch("/api/v1/worker/status",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({status:t,lat:a.coords.latitude,lng:a.coords.longitude})}),i=await n.json();if(422===n.status&&"REQUIRE_CATEGORY"===i.code){null==r||r(),g(!1);return}n.ok&&("active"===t?l("active"):"listening"===t?l("listening"):l("inactive"),h(),null==c||c()),g(!1)})}catch(t){g(!1)}}};return(0,n.jsx)("button",{onClick:v,disabled:u,className:"px-4 py-2 rounded-xl font-semibold shadow-lg transition-all hover:scale-105 active:scale-95 text-sm ".concat((()=>{switch(s){case"guest":case"listening":return"bg-yellow-500 hover:bg-yellow-600 text-white";case"inactive":return"bg-gray-500 hover:bg-gray-600 text-white";case"active":return"bg-green-500 hover:bg-green-600 text-white"}})()," ").concat(u?"opacity-50 cursor-not-allowed":""),children:u?"Procesando...":(()=>{switch(s){case"guest":return"\uD83D\uDCB8 Ganar dinero extra";case"inactive":return"âš« Modo Worker: OFF";case"listening":return"\uD83D\uDFE1 Modo Ahorro: ON";case"active":return"\uD83D\uDFE2 Modo Trabajo: ON"}})()})}}}]);