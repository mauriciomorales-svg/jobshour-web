"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{9820:function(t,e,a){a.r(e),a.d(e,{default:function(){return r}});var n=a(7437),o=a(2265),i=a(1837);function r(t){let{user:e,onActivate:a,onShowLogin:r,onRequireCategory:c,onStatusChange:s}=t,[l,u]=(0,o.useState)("guest"),[g,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{e?h():u("guest")},[e]);let h=async()=>{try{let t=localStorage.getItem("auth_token")||localStorage.getItem("token"),e=await (0,i.S)("/api/auth/me",{headers:t?{Authorization:"Bearer ".concat(t)}:{}});(await e.json()).worker,u("inactive")}catch(t){u("inactive")}},v=async t=>"inactive"===t?"active":"active"===t?"listening":"inactive",f=async()=>{if("guest"===l){localStorage.setItem("worker_intent","activate"),r();return}if("inactive"===l){a();return}let t=await v(l);if(confirm({listening:"\xbfCambiar a Modo Ahorro? Seguir\xe1s visible a 5km.",inactive:"\xbfDesconectarte del mapa?"}[t])){d(!0);try{let e=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!navigator.geolocation)return;navigator.geolocation.getCurrentPosition(async a=>{let n=await (0,i.S)("/api/v1/worker/status",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({status:t,lat:a.coords.latitude,lng:a.coords.longitude})}),o=await n.json();if(422===n.status&&"REQUIRE_CATEGORY"===o.code){null==c||c(),d(!1);return}n.ok&&("active"===t?u("active"):"listening"===t?u("listening"):u("inactive"),h(),null==s||s()),d(!1)})}catch(t){d(!1)}}};return(0,n.jsx)("button",{onClick:f,disabled:g,className:"px-4 py-2 rounded-xl font-semibold shadow-lg transition-all hover:scale-105 active:scale-95 text-sm ".concat((()=>{switch(l){case"guest":case"listening":return"bg-yellow-500 hover:bg-yellow-600 text-white";case"inactive":return"bg-gray-500 hover:bg-gray-600 text-white";case"active":return"bg-green-500 hover:bg-green-600 text-white"}})()," ").concat(g?"opacity-50 cursor-not-allowed":""),children:g?"Procesando...":(()=>{switch(l){case"guest":return"\uD83D\uDCB8 Ganar dinero extra";case"inactive":return"âš« Modo Worker: OFF";case"listening":return"\uD83D\uDFE1 Modo Ahorro: ON";case"active":return"\uD83D\uDFE2 Modo Trabajo: ON"}})()})}},1837:function(t,e,a){a.d(e,{S:function(){return o}});let n="https://jobshour.dondemorales.cl".replace(/\/api$/,"");async function o(t,e){return fetch(n?"".concat(n).concat(t):t,e)}}}]);